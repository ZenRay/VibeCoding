# 下一步行动计划

**制定日期**：2026-01-08  
**当前进度**：75% (MVP 已完成)  
**目标**：2 周内达到 90%，可正式上线

---

## 🎯 推荐方案：快速上线（2 周）

### Week 1：完成测试与优化（阶段 6）

#### Day 1-2：E2E 测试 ⭐⭐⭐

**目标**：覆盖主要用户流程

**操作步骤**：
```bash
# 1. 安装 Playwright
cd frontend
npm install -D @playwright/test
npx playwright install chromium

# 2. 创建测试目录
mkdir -p tests/e2e

# 3. 编写测试用例（3个核心场景）
# - ticket-crud.spec.ts（创建/编辑/删除）
# - search-filter.spec.ts（搜索和过滤）
# - tag-management.spec.ts（标签管理）

# 4. 运行测试
npm run test:e2e

# 5. 集成到 CI
# 更新 .github/workflows/ci.yml
```

**验收**：
- ✅ 3 个核心流程测试通过
- ✅ 可在 Docker 中运行
- ✅ CI 集成完成

---

#### Day 3：性能优化 ⭐⭐⭐

**前端优化**：
```typescript
// 1. 优化 TicketListItem（避免不必要的重渲染）
export const TicketListItem = React.memo(({ ticket, ...props }) => {
  // ...
})

// 2. 优化过滤逻辑（缓存计算结果）
const filteredTickets = useMemo(() => {
  return applyFilters(tickets, filters)
}, [tickets, filters])

// 3. 优化回调函数（避免重复创建）
const handleDelete = useCallback((id) => {
  deleteTicket(id)
}, [])
```

**后端优化**：
```python
# 1. 检查慢查询
# docker exec -it project-alpha-db psql -U ticketuser -d ticketdb
# ALTER DATABASE ticketdb SET log_min_duration_statement = 100;

# 2. 优化查询（使用 joinedload）
tickets = db.query(Ticket).options(
    joinedload(Ticket.tags)
).filter(...).all()

# 3. 验证索引使用
# EXPLAIN ANALYZE SELECT ...
```

**验收**：
- ✅ 列表滚动流畅（60fps）
- ✅ API 响应 < 500ms
- ✅ 页面加载 < 2s

---

#### Day 4：错误处理和边界情况 ⭐⭐⭐

**空状态处理**：
- 空 Ticket 列表
- 空搜索结果
- 空标签列表

**错误处理**：
- 网络错误
- API 错误（400、404、409、500）
- 表单验证错误

**加载状态**：
- 列表加载中
- 操作进行中
- 骨架屏（可选）

**验收**：
- ✅ 所有空状态有友好提示
- ✅ 所有错误有明确提示
- ✅ 加载状态清晰

---

#### Day 5：质量检查和修复 ⭐⭐

```bash
# 1. 在 Docker 中运行完整检查
cd env && ./check-running.sh

# 2. 修复所有问题

# 3. 运行所有测试
docker exec project-alpha-backend bash -c \
  "source .venv/bin/activate && pytest -v"

# 4. 验证 CI 通过
# 推送代码，查看 GitHub Actions

# 5. 代码审查
# 检查代码质量，添加注释
```

**验收**：
- ✅ 所有检查通过
- ✅ 测试覆盖率 85%+
- ✅ 零 Linter 警告
- ✅ CI 100% 通过

---

### Week 2：精简部署上线

#### Day 1：准备部署环境

**服务器准备**：
```bash
# 1. 购买云服务器（推荐配置）
- CPU: 2 核
- 内存: 4GB
- 硬盘: 40GB SSD
- 带宽: 5Mbps
- 价格: ~100 元/月（阿里云/腾讯云学生优惠更便宜）

# 2. 服务器初始化
ssh root@your-server
apt update && apt upgrade -y

# 3. 安装 Docker
curl -fsSL https://get.docker.com | sh
systemctl start docker
systemctl enable docker

# 4. 安装 Docker Compose
# Docker Desktop 已包含，或：
apt install docker-compose-plugin
```

**代码部署**：
```bash
# 1. 上传代码（在本地执行）
rsync -avz --exclude node_modules --exclude .venv \
  Week1/ user@your-server:/app/project-alpha/

# 2. 配置环境变量（在服务器上）
cd /app/project-alpha/env
cp env.example .env
# 编辑 .env，修改数据库密码等
```

---

#### Day 2：执行部署

**启动服务**：
```bash
# 1. 构建镜像
cd /app/project-alpha/env
docker compose build

# 2. 启动服务
docker compose up -d

# 3. 查看日志
docker compose logs -f

# 4. 运行数据库迁移
docker exec project-alpha-backend bash -c \
  "source .venv/bin/activate && alembic upgrade head"

# 5. 验证服务
curl http://localhost:8000/health
curl http://localhost:5173
```

**配置反向代理（可选，但推荐）**：
```bash
# 使用 Caddy（最简单，自动 HTTPS）
apt install caddy

# 编辑 Caddyfile
nano /etc/caddy/Caddyfile
```

**Caddyfile**：
```caddyfile
your-domain.com {
    reverse_proxy /api/* localhost:8000
    reverse_proxy /* localhost:5173
}
```

```bash
# 启动 Caddy
systemctl start caddy
systemctl enable caddy
```

---

#### Day 3：监控和测试

**配置监控**：
```bash
# 1. 设置日志
docker compose logs > /var/log/project-alpha.log

# 2. 设置数据库备份
crontab -e
# 每天凌晨 2 点备份
0 2 * * * docker exec project-alpha-db pg_dump -U ticketuser ticketdb > /backup/db_$(date +\%Y\%m\%d).sql
```

**功能测试**：
- ✅ 访问 https://your-domain.com
- ✅ 测试所有核心功能
- ✅ 测试在不同浏览器（Chrome、Firefox、Safari）
- ✅ 测试在移动设备（可选）

**性能测试**：
```bash
# 简单的压力测试
ab -n 1000 -c 10 http://your-domain.com/api/v1/tickets
```

---

### Week 3-4：观察期和反馈收集

#### 观察指标

**使用指标**：
- 日活用户数
- 创建的 Ticket 数量
- 使用的 Tag 数量
- 最常用的功能
- 平均响应时间

**问题记录**：
- 用户报告的 Bug
- 性能瓶颈
- 功能需求
- 改进建议

**决策依据**：
- 哪些功能最常用？
- 哪些功能最需要？
- 性能是否满足需求？
- 稳定性如何？

---

## 📋 任务检查清单

### 本周任务（Day 1-5）

- [ ] **Day 1**：E2E 测试（票据 CRUD）
- [ ] **Day 2**：E2E 测试（搜索过滤、标签管理）
- [ ] **Day 3**：性能优化（前端 + 后端）
- [ ] **Day 4**：错误处理和边界情况
- [ ] **Day 5**：质量检查和修复

### 下周任务（Day 1-3）

- [ ] **Day 1**：准备部署环境
- [ ] **Day 2**：执行部署
- [ ] **Day 3**：监控和测试

### 观察期（Week 3-4）

- [ ] 收集用户反馈
- [ ] 记录功能需求
- [ ] 发现性能问题
- [ ] 规划下一版本

---

## 🚀 快速执行指南

### 如果你现在就要开始

**今天（Day 1）**：
```bash
# 1. 安装 Playwright（5 分钟）
cd frontend
npm install -D @playwright/test
npx playwright install chromium

# 2. 创建第一个测试（30 分钟）
mkdir -p tests/e2e
# 编写 ticket-crud.spec.ts

# 3. 运行测试（5 分钟）
npx playwright test

# 4. 调试和完善（剩余时间）
npx playwright test --debug
```

**明天（Day 2）**：
```bash
# 继续完成其他 E2E 测试
# 集成到 CI
```

**后续按计划执行...**

---

## 💡 决策建议

### 场景 1：需要快速上线

**执行**：P0（3 天）+ 精简部署（2 天）= 1 周上线

**跳过**：
- 前端单元测试（可后补）
- 深度性能优化（根据实际使用情况）
- 扩展功能（根据反馈）

---

### 场景 2：追求完美上线

**执行**：P0 + P1 全部（5-7 天）+ 完整部署（3-5 天）= 2 周上线

**包含**：
- 完整的测试覆盖
- 深度性能优化
- 完善的监控

---

### 场景 3：持续迭代（推荐）⭐

**第 1 周**：P0（3 天）+ 精简部署（2 天）
**第 2 周**：观察和收集反馈
**第 3 周+**：根据反馈小步迭代

**优势**：
- 快速上线
- 真实反馈
- 避免过度开发
- 持续交付价值

---

## 📞 需要的决策

请决定：

### 决策 1：时间目标
- [ ] 1 周内上线（快速）
- [ ] 2 周内上线（稳健）
- [ ] 持续迭代（敏捷）

### 决策 2：质量要求
- [ ] 基本可用（测试覆盖率 80%+）
- [ ] 稳定可靠（测试覆盖率 90%+）

### 决策 3：部署方式
- [ ] Docker Compose 简单部署
- [ ] 完整的生产环境配置

---

## 🎉 建议

**我的推荐**：

1. **优先执行 P0 任务**（3 天）
   - E2E 测试
   - 性能优化
   - 边界处理

2. **精简部署**（2-3 天）
   - Docker Compose
   - Caddy 自动 HTTPS
   - 基础监控

3. **观察期**（1-2 周）
   - 收集反馈
   - 发现真实需求

4. **小步迭代**
   - 每周 1-2 个功能
   - 基于反馈优先级

**理由**：
- MVP 已完成，核心功能可用
- 尽早上线获取反馈
- 避免过度开发
- 持续交付价值

**预计时间线**：
- 本周完成测试
- 下周部署上线
- 第 3 周开始收集反馈
- 第 4 周开始迭代

**2 周后，系统正式上线！** 🚀
