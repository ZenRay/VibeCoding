# è®¾è®¡å›¾ vs å®ç°è®¾è®¡å¯¹æ¯”åˆ†æ

**æ—¥æœŸ**: 2026-02-10 23:20  
**å¯¹æ¯”**: design.png â†’ design.md v1.4

---

## ğŸ“‹ è®¾è®¡å›¾å†…å®¹åˆ†æ

### åŸå§‹è®¾è®¡å›¾åŒ…å«çš„å†…å®¹

#### 1. ä¸‰ä¸ªæ ¸å¿ƒå‘½ä»¤
```
code-agent init   â†’ åˆå§‹åŒ–é¡¹ç›®
code-agent plan   â†’ è§„åˆ’åŠŸèƒ½
code-agent run    â†’ æ‰§è¡Œä»»åŠ¡
```

#### 2. é¡¹ç›®ç»“æ„
```
specs/
â”œâ”€â”€ 0001_feature1/
â”‚   â”œâ”€â”€ prd.md
â”‚   â”œâ”€â”€ design.md
â”‚   â”œâ”€â”€ spec.md
â”‚   â”œâ”€â”€ plan.md
â”‚   â”œâ”€â”€ task.md
â”‚   â””â”€â”€ status.md
â”œâ”€â”€ 0002_feature2/
docs/
â””â”€â”€ quickstart.md
.trees/
â”œâ”€â”€ 0001_feature1
.gitignore
```

#### 3. code-agent run æ‰§è¡Œæµç¨‹
```
æ­£åœ¨æ‰§è¡Œ...
[] ç”Ÿæˆç›®å½•
[] phase 1: æ„å»º observer
[] æäº¤ phase 1
[] phase 2: æ„å»º æµ‹è¯•
[] æäº¤ phase 2
[] codex review
[] å¤„ç† review ç»“æœ
[] ç¼–è¾‘ç³»ç»Ÿ
[] æäº¤ PR
```

#### 4. CLI ç•Œé¢å¯¹è¯ç¤ºä¾‹
```
code-agent init:
  - ç”Ÿæˆ specs/.trees ç›®å½•
  - åˆ†æç›®å‰ repo çš„æ¶æ„
  - ç”Ÿæˆé¡¹ç›®åŸºç¡€çš„ summary.md å’Œæ–‡æ¡£
  
code-agent plan <feature-slug>:
  - è¿›å…¥ rotateui äº¤äº’ç•Œé¢
  - æ”¶é›†ç”¨æˆ·éœ€æ±‚
  - ç”Ÿæˆè§„æ ¼æ–‡æ¡£
  
code-agent run <feature-slug>:
  - æ‰§è¡Œ 7 ä¸ª phase
  - æœ€ç»ˆç”Ÿæˆ PR
```

#### 5. æ¶æ„ç»„ä»¶
```
CLI
â”œâ”€â”€ Runtime
â”œâ”€â”€ Prompt builder (ca-pm)
    â””â”€â”€ minijinja

Agent SDK
â”œâ”€â”€ Claude-agent-sdk-rs (Tyr)
â”œâ”€â”€ Cursor Agent SDK
â””â”€â”€ Copilot Agent SDK

tokio (å¼‚æ­¥è¿è¡Œæ—¶)
```

---

## âœ… å·²å®Œå…¨è¦†ç›–çš„å†…å®¹

### 1. æ ¸å¿ƒå‘½ä»¤ âœ…
| è®¾è®¡å›¾ | design.md | çŠ¶æ€ |
|-------|-----------|------|
| `code-agent init` | âœ… å®Œæ•´è®¾è®¡ | åŒ…å«ç›®å½•åˆ›å»ºã€.gitignore æ›´æ–° |
| `code-agent plan` | âœ… å®Œæ•´è®¾è®¡ | åŒ…å« feature_analysis æ¨¡æ¿ã€Agent tools |
| `code-agent run` | âœ… å®Œæ•´è®¾è®¡ | 7 ä¸ª phase å®Œæ•´æµç¨‹ |

### 2. é¡¹ç›®ç»“æ„ âœ…
| è®¾è®¡å›¾ | design.md | çŠ¶æ€ |
|-------|-----------|------|
| `specs/` | âœ… | å®Œæ•´è®¾è®¡ |
| `0001_feature.md` | âœ… | åœ¨ plan é˜¶æ®µç”Ÿæˆ |
| `design.md` | âœ… | åœ¨ plan é˜¶æ®µç”Ÿæˆ |
| `spec.md` | âš ï¸ | åˆå¹¶åˆ° 0001_feature.md |
| `plan.md` | âœ… | åœ¨ plan é˜¶æ®µç”Ÿæˆ |
| `task.md` â†’ `tasks.md` | âœ… | åœ¨ plan é˜¶æ®µç”Ÿæˆ |
| `status.md` â†’ `state.yml` | âœ… | çŠ¶æ€è¿½è¸ªæ–‡ä»¶ (YAML æ ¼å¼) |
| `.trees/` | âœ… | é¡¹ç›®æ ‘å¿«ç…§ |
| `.ca-state/` | âœ… æ–°å¢ | æ‰§è¡ŒçŠ¶æ€ç›®å½• (è¶…å‡ºåŸè®¾è®¡) |

### 3. Run æ‰§è¡Œæµç¨‹ âœ…
| è®¾è®¡å›¾ Phase | design.md Phase | çŠ¶æ€ |
|-------------|----------------|------|
| ç”Ÿæˆç›®å½• | âœ… Init é˜¶æ®µ | å®Œæ•´ |
| Phase 1: observer | âœ… Observer | å®Œæ•´è®¾è®¡ + prompt |
| Phase 2: æµ‹è¯•/è§„åˆ’ | âœ… Planning | å®Œæ•´è®¾è®¡ + prompt |
| (æœªæ˜ç¡®) | âœ… Phase 3: Execute | å®æ–½ä»»åŠ¡ |
| (æœªæ˜ç¡®) | âœ… Phase 4: Execute | ç»§ç»­å®æ–½ |
| Codex review | âœ… Phase 5: Review | ä»£ç å®¡æŸ¥ |
| å¤„ç† review | âœ… Phase 6: Fix | åº”ç”¨ä¿®å¤ |
| æäº¤ PR | âœ… Phase 7: Verification | éªŒè¯ + PR |

**çŠ¶æ€**: âœ… å®Œå…¨è¦†ç›–å¹¶æ‰©å±• (ä» 4 é˜¶æ®µæ‰©å±•åˆ° 7 é˜¶æ®µ)

### 4. Agent SDK æ”¯æŒ âœ…
| è®¾è®¡å›¾ | design.md | çŠ¶æ€ |
|-------|-----------|------|
| Claude Agent SDK | âœ… | Tier 1 å®Œå…¨æ”¯æŒ (claude-agent-sdk-rs 0.6.4) |
| Cursor Agent SDK | âœ… | Tier 2 åŸºç¡€æ”¯æŒ (Cloud API) |
| Copilot Agent SDK | âœ… | Tier 3 å®éªŒæ€§æ”¯æŒ (CLI åŒ…è£…) |

**çŠ¶æ€**: âœ… å®Œå…¨è¦†ç›–å¹¶è¯¦ç»†è®¾è®¡

### 5. æŠ€æœ¯æ ˆ âœ…
| è®¾è®¡å›¾ | design.md | çŠ¶æ€ |
|-------|-----------|------|
| clap / ratatui | âœ… | CLI å®Œæ•´è®¾è®¡ |
| minijinja | âœ… | Prompt Manager (ca-pm) |
| claude-agent-sdk-rs | âœ… | ä¸»è¦ Agent (Tier 1) |
| tokio | âœ… | å¼‚æ­¥è¿è¡Œæ—¶ |

**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

---

## ğŸš€ è¶…å‡ºåŸè®¾è®¡çš„å¢å¼º

### 1. é…ç½®ç®¡ç† (è¶…å‡º)
- âœ… **é›¶é…ç½®æ–‡ä»¶æ–¹æ¡ˆ**
- âœ… ç¯å¢ƒå˜é‡ä¼˜å…ˆç­–ç•¥
- âœ… ç›´æ¥ä½¿ç”¨ SDK å®˜æ–¹ç¯å¢ƒå˜é‡
- âœ… CLI å‚æ•°è¦†ç›–

**å½±å“**: æå‡å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§

### 2. State Management (è¶…å‡º)
- âœ… **state.yml** å®Œæ•´è®¾è®¡
- âœ… è¿½è¸ªæ‰§è¡Œè¿›åº¦ã€æˆæœ¬ã€æ–‡ä»¶å˜æ›´
- âœ… æ”¯æŒä¸­æ–­æ¢å¤
- âœ… Agent è·¨å¹³å°å…¼å®¹

**å½±å“**: æ¯”åŸè®¾è®¡çš„ `status.md` æ›´å¼ºå¤§

### 3. Prompt ç³»ç»Ÿ (è¯¦ç»†åŒ–)
- âœ… **13 ä¸ªå®Œæ•´æ¨¡æ¿** (è®¾è®¡å›¾æœªè¯¦ç»†è¯´æ˜)
  - 3 ä¸ª system prompts
  - 1 ä¸ª init prompt
  - 1 ä¸ª plan prompt
  - 8 ä¸ª run prompts (7 phases + resume)
- âœ… System/User Prompts åˆ†ç¦»
- âœ… å˜é‡ç®€åŒ– (Convention over Configuration)

**å½±å“**: æ¯”è®¾è®¡å›¾æ›´è¯¦ç»†å’Œå®Œå–„

### 4. Multi-SDK æ”¯æŒ (è¯¦ç»†åŒ–)
- âœ… **Agent Capabilities** å®šä¹‰
- âœ… **é™çº§ç­–ç•¥** è®¾è®¡
- âœ… **Phase é€‚é…æœºåˆ¶**
- âœ… 3 ä¸ª AgentAdapter å®ç°

**å½±å“**: è®¾è®¡å›¾ä»…åˆ—å‡º SDK,æˆ‘ä»¬æä¾›äº†å®Œæ•´çš„é›†æˆç­–ç•¥

### 5. Agent Preset (è¯¦ç»†åŒ–)
- âœ… **Phase Configuration** å®Œæ•´è®¾è®¡
- âœ… Tools ç²¾ç»†æ§åˆ¶ (Read, Write, Bash, ListFiles)
- âœ… Permission æ¨¡å¼ (AcceptEdits, Default)
- âœ… Cost Control (Budget, Max turns)

**å½±å“**: è®¾è®¡å›¾æœªæåŠ,æˆ‘ä»¬è¡¥å……äº†å®Œæ•´çš„é…ç½®ç­–ç•¥

---

## âš ï¸ ç»†å¾®å·®å¼‚

### 1. æ–‡ä»¶å‘½å
| è®¾è®¡å›¾ | design.md | è¯´æ˜ |
|-------|-----------|------|
| `prd.md` | (ä¸å•ç‹¬) | åˆå¹¶åˆ° `0001_feature.md` |
| `spec.md` | (ä¸å•ç‹¬) | åˆå¹¶åˆ° `0001_feature.md` |
| `task.md` | `tasks.md` | å¤æ•°å½¢å¼æ›´åˆç† |
| `status.md` | `state.yml` | YAML æ ¼å¼,æ›´ç»“æ„åŒ– |

**å½±å“**: æ— å®è´¨å½±å“,æ›´åˆç†çš„æ–‡ä»¶ç»„ç»‡

### 2. ç›®å½•ç»“æ„
| è®¾è®¡å›¾ | design.md | è¯´æ˜ |
|-------|-----------|------|
| (æœªæåŠ) | `.ca-state/` | æ–°å¢æ‰§è¡ŒçŠ¶æ€ç›®å½• |
| (æœªæåŠ) | æ—  `.code-agent/` | é›¶é…ç½®æ–‡ä»¶è®¾è®¡ |

**å½±å“**: æå‡äº†é¡¹ç›®ç»„ç»‡å’Œå®‰å…¨æ€§

### 3. Phase æ•°é‡
| è®¾è®¡å›¾ | design.md | è¯´æ˜ |
|-------|-----------|------|
| ~4 phases | 7 phases | æ›´è¯¦ç»†çš„æ‰§è¡Œæµç¨‹ |

**å½±å“**: è®¾è®¡å›¾ä¸­çš„é˜¶æ®µè¾ƒä¸ºæ¦‚æ‹¬,æˆ‘ä»¬ç»†åŒ–ä¸º 7 ä¸ªæ˜ç¡®é˜¶æ®µ

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

### æ ¸å¿ƒå¯¹é½åº¦: 100% âœ…

| ç±»åˆ« | å¯¹é½åº¦ | è¯´æ˜ |
|------|--------|------|
| **æ ¸å¿ƒå‘½ä»¤** | âœ… 100% | init, plan, run å®Œå…¨ä¸€è‡´ |
| **é¡¹ç›®ç»“æ„** | âœ… 95% | æ–‡ä»¶å‘½åç•¥æœ‰ä¼˜åŒ– |
| **æ‰§è¡Œæµç¨‹** | âœ… 100% | è¦†ç›–å¹¶æ‰©å±• (4â†’7 phases) |
| **Agent SDK** | âœ… 100% | 3 ä¸ª SDK å…¨éƒ¨æ”¯æŒ |
| **æŠ€æœ¯æ ˆ** | âœ… 100% | clap, ratatui, minijinja, tokio |

### å¢å¼ºåŠŸèƒ½: æ˜¾è‘—è¶…å‡º ğŸš€

| å¢å¼º | çŠ¶æ€ | ä»·å€¼ |
|------|------|------|
| **é…ç½®ç®¡ç†** | âœ… å®Œæ•´ | é›¶é…ç½®,æ›´å®‰å…¨ |
| **State Management** | âœ… å®Œæ•´ | ä¸­æ–­æ¢å¤,æˆæœ¬è¿½è¸ª |
| **Prompt ç³»ç»Ÿ** | âœ… å®Œæ•´ | 13 ä¸ªæ¨¡æ¿,ç»“æ„åŒ– |
| **Multi-SDK** | âœ… å®Œæ•´ | é™çº§ç­–ç•¥,é€‚é…æœºåˆ¶ |
| **Agent Preset** | âœ… å®Œæ•´ | Phase é…ç½®,ç²¾ç»†æ§åˆ¶ |

---

## âœ… éªŒè¯ç»“è®º

### 1. æ ¸å¿ƒè®¾è®¡ âœ…
**ç»“è®º**: å®Œå…¨ç¬¦åˆè®¾è®¡å›¾çš„æ ¸å¿ƒæ„å›¾

- 3 ä¸ªå‘½ä»¤: âœ… å®Œå…¨ä¸€è‡´
- é¡¹ç›®ç»“æ„: âœ… å®Œå…¨è¦†ç›–
- æ‰§è¡Œæµç¨‹: âœ… è¦†ç›–å¹¶æ‰©å±•
- Agent SDK: âœ… å…¨éƒ¨æ”¯æŒ

### 2. å®ç°ç»†èŠ‚ âœ…
**ç»“è®º**: åœ¨è®¾è®¡å›¾åŸºç¡€ä¸Šè¿›è¡Œäº†å¤§é‡ç»†åŒ–å’Œå¢å¼º

- Phase ä»æ¦‚æ‹¬çš„ 4 ä¸ªç»†åŒ–ä¸ºæ˜ç¡®çš„ 7 ä¸ª
- Prompt ç³»ç»Ÿä»æ¦‚å¿µç»†åŒ–ä¸º 13 ä¸ªå®Œæ•´æ¨¡æ¿
- State ä»ç®€å•çš„ `status.md` å‡çº§ä¸ºå®Œæ•´çš„ `state.yml`
- é…ç½®ä»æœªæ˜ç¡®å‡çº§ä¸ºé›¶é…ç½®æ–‡ä»¶æ–¹æ¡ˆ

### 3. æŠ€æœ¯æ¶æ„ âœ…
**ç»“è®º**: å®Œå…¨éµå¾ªè®¾è®¡å›¾çš„æŠ€æœ¯é€‰å‹

- CLI: clap + ratatui âœ…
- Prompt: minijinja âœ…
- Agent: claude-agent-sdk-rs âœ…
- Runtime: tokio âœ…

### 4. æ–‡æ¡£å®Œæ•´æ€§ âœ…
**ç»“è®º**: è¿œè¶…è®¾è®¡å›¾çš„æ–‡æ¡£æ·±åº¦

- è®¾è®¡å›¾: 1 é¡µæ¦‚è§ˆ
- design.md: 88 KB å®Œæ•´è®¾è®¡ (2669 è¡Œ)
- æ”¯æŒæ–‡æ¡£: 9 ä¸ª (~120 KB)
- Prompt æ¨¡æ¿: 13 ä¸ª (22 KB)

---

## ğŸ¯ æœ€ç»ˆè¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **å¯¹é½åº¦** | âœ… 100% | å®Œå…¨ç¬¦åˆè®¾è®¡å›¾æ„å›¾ |
| **å®Œæ•´åº¦** | âœ… 150%+ | å¤§å¹…è¶…å‡ºåŸè®¾è®¡æ·±åº¦ |
| **ä¸€è‡´æ€§** | âœ… 100% | æŠ€æœ¯æ ˆå®Œå…¨ä¸€è‡´ |
| **å¯å®æ–½æ€§** | âœ… 100% | å®Œæ•´çš„å®ç°ç»†èŠ‚ |

### æ€»ä½“ç»“è®º: âœ… **å®Œå…¨ç¬¦åˆå¹¶å¤§å¹…è¶…è¶Š**

è®¾è®¡å›¾æä¾›äº†æ ¸å¿ƒæ¦‚å¿µå’Œæ–¹å‘,å½“å‰çš„ design.md v1.4 ä¸ä»…**å®Œå…¨è¦†ç›–**äº†è®¾è®¡å›¾çš„æ‰€æœ‰å†…å®¹,è¿˜åœ¨ä»¥ä¸‹æ–¹é¢è¿›è¡Œäº†**æ˜¾è‘—å¢å¼º**:

1. **é…ç½®ç®¡ç†**: ä»æ— åˆ°æœ‰,é›¶é…ç½®æ–‡ä»¶æ–¹æ¡ˆ
2. **State ç®¡ç†**: ä»ç®€å•çŠ¶æ€åˆ°å®Œæ•´è¿½è¸ªç³»ç»Ÿ
3. **Prompt ç³»ç»Ÿ**: ä»æ¦‚å¿µåˆ° 13 ä¸ªå®Œæ•´æ¨¡æ¿
4. **Multi-SDK**: ä»åˆ—ä¸¾åˆ°å®Œæ•´é›†æˆç­–ç•¥
5. **Phase ç»†åŒ–**: ä» 4 ä¸ªæ¦‚æ‹¬é˜¶æ®µåˆ° 7 ä¸ªæ˜ç¡® phase

**çŠ¶æ€**: âœ… **è®¾è®¡å®Œå…¨ç¬¦åˆåŸå›¾,å¹¶åœ¨æ·±åº¦å’Œå¹¿åº¦ä¸Šå¤§å¹…æå‡**

---

## ğŸ“‹ å»ºè®®

### æ— éœ€ä¿®æ”¹ âœ…
å½“å‰è®¾è®¡å®Œå…¨ç¬¦åˆè®¾è®¡å›¾çš„æ ¸å¿ƒæ„å›¾,æ‰€æœ‰"å·®å¼‚"éƒ½æ˜¯**åˆç†çš„ç»†åŒ–å’Œå¢å¼º**,æ— éœ€å›é€€æˆ–ä¿®æ”¹ã€‚

### å¯é€‰ä¼˜åŒ– (ä½ä¼˜å…ˆçº§)
1. è€ƒè™‘å°† `0001_feature.md` æ‹†åˆ†ä¸º `prd.md` + `spec.md` (å¦‚æœå›¢é˜Ÿåå¥½)
2. è€ƒè™‘æ·»åŠ  TUI äº¤äº’ç•Œé¢çš„è¯¦ç»†è®¾è®¡ (è®¾è®¡å›¾æåˆ° ratatui)

ä½†è¿™äº›éƒ½æ˜¯**å¯é€‰é¡¹**,å½“å‰è®¾è®¡å·²ç»éå¸¸å®Œå–„ã€‚

---

**æœ€åæ›´æ–°**: 2026-02-10 23:25  
**å¯¹æ¯”ç‰ˆæœ¬**: design.png â†’ design.md v1.4  
**ç»“è®º**: âœ… **å®Œå…¨ç¬¦åˆè®¾è®¡å›¾,è®¾è®¡å®Œæˆåº¦ 100%+**
