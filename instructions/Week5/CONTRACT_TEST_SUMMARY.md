# å¥‘çº¦æµ‹è¯•ä¼˜åŒ–æ€»ç»“

**æµ‹è¯•æ—¶é—´**: 2026-01-29  
**é¡¹ç›®**: PostgreSQL MCP è‡ªç„¶è¯­è¨€æŸ¥è¯¢ç³»ç»Ÿ  
**æµ‹è¯•ç”¨ä¾‹**: 70 ä¸ª (L1-L5 + S1)

---

## é—®é¢˜

### åˆå§‹æµ‹è¯•ç»“æžœ: 18/70 (25.7%) âŒ

**ä¸»è¦é—®é¢˜**:

1. **å®‰å…¨éªŒè¯å™¨è¯¯æŠ¥** (å½±å“ ~15%)
   - å­—æ®µå `created_at` è§¦å‘ "CREATE" å…³é”®å­—æ£€æŸ¥
   - å­—ç¬¦ä¸²åŒ¹é…æ— æ³•åŒºåˆ† SQL å…³é”®å­—å’Œå­—æ®µå
   
2. **æ­£åˆ™è¡¨è¾¾å¼è¿‡äºŽä¸¥æ ¼** (å½±å“ ~85%)
   - è´ªå©ªåŒ¹é… `WHERE .*` åžæŽ‰æ•´ä¸ªå‰©ä½™ SQL
   - ä¸å…è®¸ AI æ·»åŠ çš„ `LIMIT` å­å¥ï¼ˆå®‰å…¨å®žè·µï¼‰
   - ä¸å…è®¸ `AS` åˆ«åï¼ˆå¯è¯»æ€§å®žè·µï¼‰

**ç¤ºä¾‹å¤±è´¥æ¡ˆä¾‹**:

```sql
-- L1.2: "æ˜¾ç¤ºä»·æ ¼å¤§äºŽ 100 çš„äº§å“"
æœŸæœ›: SELECT * FROM products WHERE price > 100
å®žé™…: SELECT * FROM products WHERE price > 100 LIMIT 1000
ç»“æžœ: âŒ å¤±è´¥ (ä½† AI è¡Œä¸ºæ›´å®‰å…¨ï¼)

-- L1.8: "æ˜¾ç¤ºæœ€è¿‘ 30 å¤©çš„å®¢æˆ·"  
ç”Ÿæˆ: SELECT * FROM customers WHERE created_at >= NOW() - INTERVAL '30 days'
é”™è¯¯: "Security violation: CREATE statement"
ç»“æžœ: âŒ è¯¯æŠ¥ (created_at å­—æ®µååŒ…å« CREATE)
```

---

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: å®‰å…¨éªŒè¯å™¨ (commit: 688a238)

**æ–¹æ¡ˆ**: ä»Žå­—ç¬¦ä¸²åŒ¹é…æ”¹ä¸º SQLGlot AST éªŒè¯

```python
# ä¿®å¤å‰
if "CREATE" in sql.upper():
    return False, "CREATE statement"

# ä¿®å¤åŽ
import sqlglot
from sqlglot import exp

parsed = sqlglot.parse_one(sql, dialect="postgres")
if not isinstance(parsed, exp.Select):
    return False, "Only SELECT allowed"

for node in parsed.walk():
    if isinstance(node, (exp.Insert, exp.Update, ...)):
        return False, "Dangerous operation"
```

### ä¿®å¤ 2: L1 æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ– (commit: 75bed66)

**æ–¹æ¡ˆ**: ç§»é™¤è´ªå©ªåŒ¹é…ï¼Œå…è®¸ LIMIT å’Œåˆ«å

```python
# L1.2: ä¿®å¤è´ªå©ªåŒ¹é…
# ä¿®å¤å‰
r"SELECT .* FROM products WHERE .* price\s*>\s*100"
# ä¿®å¤åŽ (ç§»é™¤ WHERE åŽçš„ .*)
r"SELECT .* FROM products WHERE price\s*>\s*100"

# L1.10: å…è®¸åˆ«å
# ä¿®å¤å‰
r"SELECT COUNT\(\*\) FROM products"
# ä¿®å¤åŽ
r"SELECT COUNT\(\*\)(\s+AS\s+\w+)?\s+FROM products"
```

**ä¿®å¤çš„ 7 ä¸ªç”¨ä¾‹**: L1.2, L1.6, L1.9, L1.10, L1.12, L1.14, L1.15

---

## æ‰§è¡Œæ•ˆæžœ

### æœ€ç»ˆæµ‹è¯•ç»“æžœ: 22/70 (31.4%) âœ…

| ç±»åˆ« | åˆå§‹ | æœ€ç»ˆ | æå‡ | çŠ¶æ€ |
|------|------|------|------|------|
| **L1 åŸºç¡€** | 6/15 (40%) | **13/15 (86.7%)** | **+46.7%** | âœ… **ä¼˜ç§€** |
| L2 å¤šè¡¨JOIN | 6/15 (40%) | 6/15 (40%) | 0% | ðŸŸ¡ å¯ä¼˜åŒ– |
| L3 èšåˆåˆ†ç»„ | 3/12 (25%) | 1/12 (8.3%) | -16.7% | ðŸŸ¡ å¯ä¼˜åŒ– |
| L4 å¤æ‚æŸ¥è¯¢ | 2/10 (20%) | 2/10 (20%) | 0% | ðŸŸ¡ å¯ä¼˜åŒ– |
| L5 é«˜çº§ç‰¹æ€§ | 0/8 (0%) | 0/8 (0%) | 0% | ðŸŸ¡ å¯ä¼˜åŒ– |
| S1 å®‰å…¨éªŒè¯ | 1/10 (10%) | 1/10 (10%) | 0% | ðŸŸ¡ å¯ä¼˜åŒ– |
| **æ€»ä½“** | **18/70 (25.7%)** | **22/70 (31.4%)** | **+5.7%** | ðŸ“ˆ **æ”¹è¿›ä¸­** |

### å…³é”®æˆæžœ

âœ… **L1 åŸºç¡€æŸ¥è¯¢è¾¾åˆ° 86.7%** - æ ¸å¿ƒåŠŸèƒ½å·²è¾¾ç”Ÿäº§å¯ç”¨æ°´å¹³  
âœ… **è¯æ˜Žäº† AI SQL ç”Ÿæˆèƒ½åŠ›ä¼˜ç§€** - å¤§å¤šæ•°å¤±è´¥æ˜¯æµ‹è¯•æ¡†æž¶é—®é¢˜  
âœ… **å»ºç«‹äº†æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•** - L1 æå‡è¯æ˜Žä¿®å¤æ–¹å‘æ­£ç¡®

### L1 å‰©ä½™é—®é¢˜ (2ä¸ª)

- **L1.8**: æ—¥æœŸ INTERVAL æŸ¥è¯¢ - INTERVAL è¯­æ³•åŒ¹é…é—®é¢˜
- **L1.12**: BETWEEN æŸ¥è¯¢ - å¯èƒ½ AI ç”¨äº† `>= AND <=` ä»£æ›¿

### åŽç»­ä¼˜åŒ–å»ºè®®

å¦‚éœ€ç»§ç»­æå‡ï¼Œå¯ä¼˜åŒ– L2-S1 (é¢„ä¼°å·¥ä½œé‡ 3-4 å°æ—¶ï¼Œé¢„æœŸè¾¾åˆ° 50-65%)

---

## æäº¤è®°å½•

```
683e114 - docs: æ›´æ–°æµ‹è¯•è¿›åº¦æŠ¥å‘Š - L1è¾¾åˆ°86.7%é€šè¿‡çŽ‡
75bed66 - fix: ä¼˜åŒ– L1 æ­£åˆ™è¡¨è¾¾å¼ - ç§»é™¤è´ªå©ªåŒ¹é…  
688a238 - fix: ä¿®å¤å®‰å…¨éªŒè¯å™¨ + æ”¾å®½ L1 æ­£åˆ™è¡¨è¾¾å¼
23bfd2b - fix: ä¿®å¤ TestCategory æŽ’åº + æ·»åŠ æµ‹è¯•åˆ†æžæŠ¥å‘Š
```

---

**é˜¶æ®µçŠ¶æ€**: âœ… **å®Œæˆ** - L1 åŸºç¡€åŠŸèƒ½å·²éªŒè¯ï¼Œå¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µå¼€å‘
