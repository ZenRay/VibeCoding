# å¤šç‰ˆæœ¬é¡¹ç›®ç®¡ç†å®Œæ•´æŒ‡å—

**ç‰ˆæœ¬**: v2.0.0  
**æ—¥æœŸ**: 2026-02-01  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ æ¦‚è¿°

æ”¯æŒåœ¨åŒä¸€ä¸ªå·¥ä½œç©ºé—´ä¸­åˆ›å»ºå’Œç®¡ç†å¤šä¸ªç‹¬ç«‹çš„å¹»ç¯ç‰‡é¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®ç‰ˆæœ¬å®Œå…¨éš”ç¦»ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ—‚ï¸ **ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†**ï¼šæ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„ `outline.yml` å’Œèµ„æºæ–‡ä»¶
- ğŸ¨ **ç‰ˆæœ¬é€‰æ‹©å™¨**ï¼šå¯åŠ¨æ—¶é€‰æ‹©ç°æœ‰ç‰ˆæœ¬æˆ–åˆ›å»ºæ–°é¡¹ç›®
- ğŸ’¾ **å®Œæ•´éš”ç¦»**ï¼šä¸åŒç‰ˆæœ¬äº’ä¸å¹²æ‰°ï¼Œå¯ä»¥å¹¶è¡Œç¼–è¾‘
- ğŸ”„ **ç‰ˆæœ¬åˆ‡æ¢**ï¼šæ— éœ€é‡å¯å³å¯åˆ‡æ¢ä¸åŒé¡¹ç›®

---

## ğŸ—ï¸ ç›®å½•ç»“æ„

```
Week7/
â””â”€â”€ assets/
    â”œâ”€â”€ v1/
    â”‚   â”œâ”€â”€ outline.yml          # ç‰ˆæœ¬1çš„é¡¹ç›®æ•°æ®
    â”‚   â”œâ”€â”€ style_xxx.png        # é£æ ¼å›¾ç‰‡
    â”‚   â””â”€â”€ slide_xxx.png        # å¹»ç¯ç‰‡å›¾ç‰‡
    â”œâ”€â”€ v2/
    â”‚   â”œâ”€â”€ outline.yml          # ç‰ˆæœ¬2çš„é¡¹ç›®æ•°æ®
    â”‚   â””â”€â”€ ...
    â””â”€â”€ v3/
        â”œâ”€â”€ outline.yml          # ç‰ˆæœ¬3çš„é¡¹ç›®æ•°æ®
        â””â”€â”€ ...
```

### outline.yml ç»“æ„

```yaml
version: 1                              # ç‰ˆæœ¬å·
created_at: "2026-02-01 12:12:54"       # åˆ›å»ºæ—¶é—´
project_name: "ç§‘æŠ€é£æ¼”ç¤º"               # é¡¹ç›®åç§°ï¼ˆå¯é€‰ï¼‰
style_prompt: "ç°ä»£ç§‘æŠ€é£æ ¼"             # é£æ ¼æè¿°
style_reference: assets/v1/style_xxx.png # é£æ ¼å‚è€ƒå›¾ç‰‡
slides:                                  # å¹»ç¯ç‰‡åˆ—è¡¨
  - id: "uuid-1"
    text: "æ ‡é¢˜\nå†…å®¹..."
    image_path: assets/v1/slide_xxx.png
    content_hash: "hash1"
    image_hash: "hash2"
```

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### 1. é¦–æ¬¡å¯åŠ¨ï¼ˆæ— ç‰ˆæœ¬ï¼‰

```
æ‰“å¼€åº”ç”¨
  â†“
æ˜¾ç¤ºç©ºç™½ç‰ˆæœ¬é€‰æ‹©å™¨
  â†“
ç‚¹å‡»"åˆ›å»ºæ–°é¡¹ç›®"
  â†“
è¾“å…¥é£æ ¼æè¿° â†’ ç”Ÿæˆé£æ ¼å€™é€‰ â†’ é€‰æ‹©é£æ ¼
  â†“
åˆ›å»º v1 ç‰ˆæœ¬ï¼Œè¿›å…¥ç¼–è¾‘ç•Œé¢
```

### 2. å·²æœ‰ç‰ˆæœ¬

```
æ‰“å¼€åº”ç”¨
  â†“
æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬å¡ç‰‡
  â”œâ”€ v1: 8 å¼ å¹»ç¯ç‰‡ (2026-01-30)
  â”œâ”€ v2: 3 å¼ å¹»ç¯ç‰‡ (2026-01-31)
  â””â”€ v3: 5 å¼ å¹»ç¯ç‰‡ (2026-02-01)
  â†“
é€‰æ‹©ä»»æ„ç‰ˆæœ¬ â†’ è¿›å…¥ç¼–è¾‘ç•Œé¢
æˆ–
ç‚¹å‡»"åˆ›å»ºæ–°é¡¹ç›®" â†’ åˆ›å»º v4
```

### 3. ç‰ˆæœ¬åˆ‡æ¢

åœ¨ä¸»ç•Œé¢ï¼š
- å½“å‰ç‰ˆæœ¬æ˜¾ç¤ºåœ¨æ ‡é¢˜æ 
- å¯ä»¥é€€å‡ºåˆ°ç‰ˆæœ¬é€‰æ‹©å™¨
- é€‰æ‹©å…¶ä»–ç‰ˆæœ¬ç»§ç»­ç¼–è¾‘

---

## ğŸ”§ API ç«¯ç‚¹

### ç‰ˆæœ¬ç®¡ç†

```bash
# åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬
GET /api/versions
â†’ { versions: [ { version: 1, slide_count: 3, ... }, ... ] }

# è·å–ç‰ˆæœ¬ä¿¡æ¯
GET /api/versions/1
â†’ { version: 1, created_at: "...", style_reference: "...", ... }

# åˆ›å»ºæ–°ç‰ˆæœ¬
POST /api/versions/create
Body: { description: "ç§‘æŠ€é£" }
â†’ { version: 2, message: "New version created successfully" }
```

### é¡¹ç›®æ“ä½œï¼ˆéœ€è¦ç‰ˆæœ¬å‚æ•°ï¼‰

```bash
# è·å–é¡¹ç›®çŠ¶æ€
GET /api/project?version=1

# åˆå§‹åŒ–é£æ ¼
POST /api/style/init?version=1
Body: { description: "ç°ä»£é£æ ¼" }

# åˆ›å»ºå¹»ç¯ç‰‡
POST /api/slides?version=1
Body: { text: "æ ‡é¢˜\nå†…å®¹" }

# æ›´æ–°å¹»ç¯ç‰‡
PUT /api/slides/{slide_id}?version=1
Body: { text: "æ–°æ–‡æœ¬" }
```

---

## ğŸ’» å‰ç«¯ç»„ä»¶

### VersionSelector ç»„ä»¶

```typescript
// ç‰ˆæœ¬é€‰æ‹©å™¨ç•Œé¢
<VersionSelector onSelectVersion={(version) => {
  // åŠ è½½é€‰ä¸­çš„ç‰ˆæœ¬
  loadProject(version);
}} />
```

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬å¡ç‰‡ï¼ˆç¼©ç•¥å›¾ã€å¹»ç¯ç‰‡æ•°ã€åˆ›å»ºæ—¶é—´ï¼‰
- ç‚¹å‡»"ç»§ç»­ç¼–è¾‘"åŠ è½½ç‰ˆæœ¬
- ç‚¹å‡»"åˆ›å»ºæ–°é¡¹ç›®"æ˜¾ç¤ºé£æ ¼åˆå§‹åŒ–å™¨
- ç©ºçŠ¶æ€æç¤º

### ç‰ˆæœ¬çŠ¶æ€ç®¡ç†

```typescript
// Zustand Store
const {
  currentVersion,        // å½“å‰ç‰ˆæœ¬å·
  setVersion,           // è®¾ç½®ç‰ˆæœ¬
  loadProject,          // åŠ è½½é¡¹ç›®ï¼ˆéœ€è¦ç‰ˆæœ¬å‚æ•°ï¼‰
  createSlide,          // åˆ›å»ºå¹»ç¯ç‰‡ï¼ˆè‡ªåŠ¨ä½¿ç”¨å½“å‰ç‰ˆæœ¬ï¼‰
  // ...
} = useAppStore();
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šé¦–æ¬¡ä½¿ç”¨

1. å¯åŠ¨åº”ç”¨ â†’ æ— ç‰ˆæœ¬
2. æ˜¾ç¤ºç©ºç™½ç‰ˆæœ¬é€‰æ‹©å™¨
3. åˆ›å»ºæ–°é¡¹ç›® â†’ ç”Ÿæˆ v1
4. éªŒè¯æ–‡ä»¶ï¼š`assets/v1/outline.yml` å­˜åœ¨

### åœºæ™¯ 2ï¼šå¤šç‰ˆæœ¬ç®¡ç†

1. å·²æœ‰ v1, v2, v3 ä¸‰ä¸ªç‰ˆæœ¬
2. æ˜¾ç¤º 3 ä¸ªç‰ˆæœ¬å¡ç‰‡
3. ç‚¹å‡» v2 "ç»§ç»­ç¼–è¾‘" â†’ åŠ è½½ v2 æ•°æ®
4. æ·»åŠ å¹»ç¯ç‰‡ â†’ ä¿å­˜åˆ° `assets/v2/outline.yml`
5. åˆ‡æ¢åˆ° v1 â†’ æ•°æ®æ­£ç¡®éš”ç¦»

### åœºæ™¯ 3ï¼šåˆ›å»ºæ–°ç‰ˆæœ¬

1. åœ¨ç‰ˆæœ¬é€‰æ‹©å™¨ç‚¹å‡»"åˆ›å»ºæ–°é¡¹ç›®"
2. è¾“å…¥é£æ ¼æè¿°ï¼š"æœ«æ—¥é»„æ˜é£æ ¼"
3. ç”Ÿæˆé£æ ¼å€™é€‰ â†’ é€‰æ‹©é£æ ¼
4. åˆ›å»º v4 â†’ æ–‡ä»¶ `assets/v4/outline.yml` åˆ›å»ºæˆåŠŸ

---

## ğŸ“Š æ•°æ®éš”ç¦»

| æ“ä½œ | v1 | v2 | v3 |
|------|----|----|-----|
| æ·»åŠ å¹»ç¯ç‰‡ | âœ… ä¿å­˜åˆ° v1 | âŒ ä¸å½±å“ | âŒ ä¸å½±å“ |
| ä¿®æ”¹é£æ ¼ | âœ… æ›´æ–° v1 | âŒ ä¸å½±å“ | âŒ ä¸å½±å“ |
| åˆ é™¤å¹»ç¯ç‰‡ | âœ… ä» v1 åˆ é™¤ | âŒ ä¸å½±å“ | âŒ ä¸å½±å“ |

**æ¯ä¸ªç‰ˆæœ¬å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ï¼**

---

## ğŸ”„ è¿ç§»æ—§æ•°æ®

å¦‚æœæ ¹ç›®å½•å­˜åœ¨æ—§çš„ `outline.yml`ï¼Œéœ€è¦è¿ç§»åˆ°ç‰ˆæœ¬ç›®å½•ï¼š

```bash
# æ‰‹åŠ¨è¿ç§»
mkdir -p assets/v1
mv outline.yml assets/v1/
mv assets/style_*.png assets/v1/
mv assets/slide_*.png assets/v1/

# æ›´æ–° outline.yml ä¸­çš„è·¯å¾„
# style_reference: assets/style_xxx.png
# â†’ style_reference: assets/v1/style_xxx.png
```

---

## âš™ï¸ åç«¯å®ç°ç»†èŠ‚

### YAMLStore ç±»

```python
class YAMLStore:
    def __init__(self, version: Optional[int] = None):
        """
        Args:
            version: ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰
                - å¦‚æœæä¾›ï¼Œä½¿ç”¨ assets/vX/outline.yml
                - å¦‚æœä¸º Noneï¼Œç”¨äºç‰ˆæœ¬ç®¡ç†åŠŸèƒ½
        """
        if version is not None:
            self.file_path = Path("assets") / f"v{version}" / "outline.yml"
            self.version = version
        else:
            self.file_path = None
            self.version = None
    
    def list_versions(self) -> List[int]:
        """æ‰«æ assets/ è¿”å›æ‰€æœ‰ç‰ˆæœ¬å·"""
        
    def create_new_version(self, style_prompt: str) -> int:
        """åˆ›å»ºæ–°ç‰ˆæœ¬ç›®å½•å’Œ outline.yml"""
```

### GeminiGenerator ç±»

```python
class GeminiGenerator:
    def __init__(self, ..., version: int):
        """ç»‘å®šåˆ°ç‰¹å®šç‰ˆæœ¬"""
        self.version = version
        self.assets_dir = Path("assets") / f"v{version}"
        self.yaml_store = YAMLStore(version=version)
```

### èµ„æºç¼“å­˜

```python
# æ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹çš„èµ„æºå®ä¾‹
_generators = {}  # { version: (YAMLStore, GeminiGenerator) }

def get_version_resources(version: int):
    if version not in _generators:
        yaml_store = YAMLStore(version=version)
        generator = GeminiGenerator(..., version=version)
        _generators[version] = (yaml_store, generator)
    return _generators[version]
```

---

## ğŸ¨ UI è®¾è®¡

### ç‰ˆæœ¬é€‰æ‹©å™¨ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          AI Slide Generator                â”‚
â”‚                                            â”‚
â”‚    é€‰æ‹©é¡¹ç›®ç»§ç»­ç¼–è¾‘ï¼Œæˆ–åˆ›å»ºæ–°é¡¹ç›®            â”‚
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  v3       â”‚  â”‚  v2       â”‚  â”‚  v1       â”‚â”‚
â”‚  â”‚ [ç¼©ç•¥å›¾]  â”‚  â”‚ [ç¼©ç•¥å›¾]  â”‚  â”‚ [ç¼©ç•¥å›¾]  â”‚â”‚
â”‚  â”‚ 5 å¼ å¹»ç¯ç‰‡â”‚  â”‚ 3 å¼ å¹»ç¯ç‰‡â”‚  â”‚ 8 å¼ å¹»ç¯ç‰‡â”‚â”‚
â”‚  â”‚ 2026-02-01â”‚  â”‚ 2026-01-31â”‚  â”‚ 2026-01-30â”‚â”‚
â”‚  â”‚[ç»§ç»­ç¼–è¾‘] â”‚  â”‚[ç»§ç»­ç¼–è¾‘] â”‚  â”‚[ç»§ç»­ç¼–è¾‘] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                            â”‚
â”‚           [+ åˆ›å»ºæ–°é¡¹ç›®]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é¡¹ç›®å‘½å

åœ¨åˆ›å»ºæ–°ç‰ˆæœ¬æ—¶ï¼Œå¯ä»¥è®¾ç½® `project_name`ï¼š

```yaml
version: 1
project_name: "äº§å“å‘å¸ƒä¼šæ¼”ç¤º"  # ä¾¿äºè¯†åˆ«
style_prompt: "ç§‘æŠ€é£"
```

### 2. ç‰ˆæœ¬ç®¡ç†

- å®šæœŸåˆ é™¤ä¸éœ€è¦çš„æ—§ç‰ˆæœ¬
- å¯¼å‡ºé‡è¦ç‰ˆæœ¬ï¼ˆå¤‡ä»½æ•´ä¸ª `assets/vX/` ç›®å½•ï¼‰
- ç‰ˆæœ¬å·è‡ªåŠ¨é€’å¢ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†

### 3. æ€§èƒ½ä¼˜åŒ–

- ç‰ˆæœ¬åˆ—è¡¨è‡ªåŠ¨ç¼“å­˜
- åˆ‡æ¢ç‰ˆæœ¬æ—¶èµ„æºå¤ç”¨
- å¤§æ–‡ä»¶ï¼ˆå›¾ç‰‡ï¼‰æŒ‰éœ€åŠ è½½

---

## ğŸ› æ•…éšœæ’é™¤

### ç‰ˆæœ¬åˆ—è¡¨ä¸ºç©º

```bash
# æ£€æŸ¥ assets ç›®å½•
ls -la assets/
# åº”è¯¥çœ‹åˆ° v1/, v2/, v3/ ç­‰ç›®å½•

# æ£€æŸ¥æƒé™
chmod -R 755 assets/
```

### åˆ›å»ºç‰ˆæœ¬å¤±è´¥

```bash
# æ£€æŸ¥ assets ç›®å½•æ˜¯å¦å­˜åœ¨ä¸”å¯å†™
mkdir -p assets
chmod 755 assets

# æ£€æŸ¥åç«¯æ—¥å¿—
tail -50 backend/api.log
```

### ç‰ˆæœ¬æ•°æ®ä¸¢å¤±

æ¯ä¸ªç‰ˆæœ¬çš„æ•°æ®éƒ½åœ¨ `assets/vX/outline.yml`ï¼Œç¡®ä¿ï¼š
1. æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ï¼ˆYAMLï¼‰
2. åŒ…å«å¿…éœ€å­—æ®µï¼š`version`, `slides`
3. è·¯å¾„æ­£ç¡®ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰

---

## ğŸ“š ç›¸å…³ä»£ç 

### åç«¯
- `backend/app/data/yaml_store.py` - æ•°æ®å­˜å‚¨
- `backend/app/api/endpoints.py` - API ç«¯ç‚¹
- `backend/app/core/generator.py` - å›¾ç‰‡ç”Ÿæˆå™¨

### å‰ç«¯
- `frontend/src/components/VersionSelector.tsx` - ç‰ˆæœ¬é€‰æ‹©å™¨
- `frontend/src/store/appStore.ts` - çŠ¶æ€ç®¡ç†
- `frontend/src/api/client.ts` - API å®¢æˆ·ç«¯
- `frontend/src/App.tsx` - ä¸»åº”ç”¨

---

**æœ€åæ›´æ–°**: 2026-02-01  
**ç»´æŠ¤è€…**: Ray
