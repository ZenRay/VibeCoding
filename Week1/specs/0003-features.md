# Project Alpha 功能说明文档

**文档版本**: v1.1  
**创建时间**: 2026-01-08  
**最后更新**: 2026-01-08

## 📋 目录

1. [UI 布局和设计](#ui-布局和设计)
2. [前后端交互功能](#前后端交互功能)
3. [搜索和过滤功能](#搜索和过滤功能)
4. [批量操作功能](#批量操作功能)
5. [排序功能](#排序功能)

---

## UI 布局和设计

### ✅ 已实现的布局结构

参考现代 Ticket 管理系统的 UI 设计，实现了以下布局：

#### 1. 整体布局
- **左侧固定边栏**：宽度 256px，包含状态过滤和标签过滤
- **主内容区域**：自适应宽度，包含顶部栏、工具栏和 Ticket 列表
- **全屏高度布局**：使用 `h-screen` 和 `flex` 实现

#### 2. 顶部栏
- **左侧**：项目标题 "Project Alpha"（蓝色，突出显示）
- **中间**：搜索框（带搜索图标，实时搜索）
- **右侧**：操作按钮（"管理标签"、"新建 Ticket"）

#### 3. 工具栏
- **左侧**：批量操作按钮（显示已选择数量）
- **右侧**：排序选择器 + 排序方向按钮（升序/降序）

#### 4. Ticket 列表
- **列表布局**：垂直列表，每个 Ticket 占一行
- **列表项**：复选框 + 标题 + 描述 + 创建时间 + 标签 + 操作按钮
- **悬停效果**：鼠标悬停时背景色变化
- **删除样式**：已删除的 Ticket 显示删除线和半透明效果

---

## 前后端交互功能

### ✅ 已实现的交互功能

#### 1. Ticket 管理功能

##### 创建 Ticket
- **位置**: 页面右上角"创建 Ticket"按钮
- **功能**: 
  - 填写标题（必填）和描述（可选）
  - 选择关联的标签（可选）
  - 调用 `POST /api/v1/tickets` API
  - 创建成功后自动刷新列表

##### 编辑 Ticket
- **位置**: 每个 Ticket 卡片上的编辑按钮（铅笔图标）
- **功能**:
  - 修改标题和描述
  - 添加或移除标签
  - 调用 `PUT /api/v1/tickets/{id}` API
  - 调用 `POST /api/v1/tickets/{id}/tags` 和 `DELETE /api/v1/tickets/{id}/tags/{tag_id}` API
  - 更新成功后自动刷新列表

##### 删除 Ticket（软删除）
- **位置**: 每个 Ticket 卡片上的删除按钮（垃圾桶图标）
- **功能**:
  - 确认对话框
  - 调用 `DELETE /api/v1/tickets/{id}` API（默认软删除）
  - 删除后 Ticket 显示删除线样式
  - 删除成功后自动刷新列表

##### 恢复 Ticket
- **位置**: 已删除的 Ticket 卡片上的"恢复"按钮
- **功能**:
  - 调用 `POST /api/v1/tickets/{id}/restore` API
  - 恢复成功后自动刷新列表

##### 切换 Ticket 状态
- **位置**: 每个 Ticket 卡片上的"标记完成"/"标记未完成"按钮
- **功能**:
  - 调用 `PATCH /api/v1/tickets/{id}/toggle-status` API
  - 在 pending ↔ completed 之间切换
  - 切换成功后自动刷新列表

#### 2. 标签管理功能

##### 创建标签
- **位置**: 页面右上角"创建标签"按钮
- **功能**:
  - 填写标签名称（必填，英文字符会自动转大写）
  - 选择颜色（颜色选择器 + 预设颜色）
  - 调用 `POST /api/v1/tags` API
  - 创建成功后自动刷新列表

##### 编辑标签
- **位置**: 点击标签卡片
- **功能**:
  - 修改标签名称和颜色
  - 调用 `PUT /api/v1/tags/{id}` API
  - 更新成功后自动刷新列表

##### 删除标签
- **位置**: 标签卡片右上角的删除按钮
- **功能**:
  - 确认对话框
  - 调用 `DELETE /api/v1/tags/{id}` API
  - 删除后自动刷新标签和 Ticket 列表

#### 3. UI 组件

已创建以下 Shadcn UI 风格的组件：
- ✅ `Button` - 按钮组件（支持多种变体）
- ✅ `Card` - 卡片组件
- ✅ `Dialog` - 对话框组件
- ✅ `Input` - 输入框组件
- ✅ `Label` - 标签组件
- ✅ `Select` - 选择框组件

#### 4. API 调用映射

| 前端操作 | 后端 API | 方法 |
|---------|---------|------|
| 创建 Ticket | `/api/v1/tickets` | POST |
| 编辑 Ticket | `/api/v1/tickets/{id}` | PUT |
| 删除 Ticket | `/api/v1/tickets/{id}` | DELETE |
| 恢复 Ticket | `/api/v1/tickets/{id}/restore` | POST |
| 切换状态 | `/api/v1/tickets/{id}/toggle-status` | PATCH |
| 添加标签到 Ticket | `/api/v1/tickets/{id}/tags` | POST |
| 移除 Ticket 标签 | `/api/v1/tickets/{id}/tags/{tag_id}` | DELETE |
| 创建标签 | `/api/v1/tags` | POST |
| 编辑标签 | `/api/v1/tags/{id}` | PUT |
| 删除标签 | `/api/v1/tags/{id}` | DELETE |

---

## 搜索和过滤功能

### ✅ 已实现的搜索功能

#### 1. 搜索功能

##### 标题搜索
- **位置**: Ticket 列表上方的搜索框
- **功能**: 
  - 实时搜索 Ticket 标题（防抖 300ms）
  - 支持中文和英文搜索
  - 调用 `GET /api/v1/tickets?search={关键词}` API
  - 搜索结果实时更新

##### 使用方式
1. 在搜索框中输入关键词（如"认证"、"备份"等）
2. 系统会自动搜索并显示匹配的 Ticket
3. 点击搜索框右侧的 X 按钮可以清除搜索

#### 2. 过滤功能

##### 状态过滤
- **快速过滤按钮**: "全部"、"未完成"、"已完成"
- **过滤器面板**: 下拉选择框
- **功能**:
  - 过滤 Ticket 状态（pending/completed）
  - 调用 `GET /api/v1/tickets?status={status}` API
  - 支持快速切换

##### 标签过滤
- **位置**: 过滤器面板中的"标签过滤"区域
- **功能**:
  - 点击标签可以添加/移除过滤条件
  - 支持多标签过滤（AND 逻辑）
  - 调用 `GET /api/v1/tickets?tag_ids={id1,id2}&tag_filter=and` API
  - 已选择的标签会高亮显示

##### 包含已删除
- **位置**: 过滤器面板中的复选框
- **功能**:
  - 勾选后显示已删除的 Ticket（带删除线）
  - 调用 `GET /api/v1/tickets?include_deleted=true` API

#### 3. UI 组件

##### SearchAndFilter 组件
- **搜索框**: 带搜索图标和清除按钮
- **过滤器按钮**: 展开/收起过滤器面板
- **快速过滤**: 状态快速切换按钮
- **过滤器面板**: 
  - 状态下拉选择
  - 标签选择（可点击）
  - 包含已删除复选框
- **当前过滤条件显示**: 显示当前激活的过滤条件
- **清除所有按钮**: 一键清除所有过滤条件

#### 4. API 调用映射

| 前端操作 | 后端 API | 查询参数 |
|---------|---------|---------|
| 搜索标题 | `/api/v1/tickets` | `search={关键词}` |
| 状态过滤 | `/api/v1/tickets` | `status={pending\|completed}` |
| 标签过滤 | `/api/v1/tickets` | `tag_ids={id1,id2}&tag_filter=and` |
| 包含已删除 | `/api/v1/tickets` | `include_deleted=true` |
| 组合过滤 | `/api/v1/tickets` | 多个参数组合 |

#### 5. UI 特性

- **防抖搜索**: 输入后 300ms 才触发搜索，避免频繁请求
- **实时更新**: 搜索和过滤条件改变时自动刷新列表
- **视觉反馈**: 
  - 激活的过滤条件会高亮显示
  - 当前过滤条件会显示在搜索框下方
  - 无结果时显示提示信息
- **清除功能**: 
  - 搜索框右侧的 X 按钮清除搜索
  - "清除所有"按钮清除所有过滤条件

---

## 📝 使用说明

### 访问前端页面
1. 打开浏览器访问：http://localhost:5173
2. 应该看到：
   - 标签列表（可点击编辑，右上角删除按钮）
   - Ticket 列表（每个卡片有操作按钮）
   - 搜索和过滤功能

### 测试交互功能

1. **创建 Ticket**:
   - 点击右上角"创建 Ticket"按钮
   - 填写标题和描述
   - 选择标签（可选）
   - 点击"创建"按钮
   - 应该看到新 Ticket 出现在列表中

2. **编辑 Ticket**:
   - 点击 Ticket 卡片上的编辑按钮（铅笔图标）
   - 修改标题、描述或标签
   - 点击"更新"按钮
   - 应该看到 Ticket 更新

3. **切换状态**:
   - 点击 Ticket 卡片上的"标记完成"按钮
   - 应该看到状态变为"已完成"
   - 再次点击可以切换回"未完成"

4. **删除 Ticket**:
   - 点击 Ticket 卡片上的删除按钮（垃圾桶图标）
   - 确认删除
   - 应该看到 Ticket 显示删除线样式
   - 点击"恢复"按钮可以恢复

5. **创建标签**:
   - 点击右上角"创建标签"按钮
   - 填写名称和选择颜色
   - 点击"创建"按钮
   - 应该看到新标签出现在列表中

6. **编辑/删除标签**:
   - 点击标签卡片可以编辑
   - 点击标签卡片右上角的删除按钮可以删除

7. **搜索 Ticket**:
   - 在搜索框输入关键词（如"认证"）
   - 系统自动搜索并显示匹配结果

8. **过滤 Ticket**:
   - 点击"未完成"/"已完成"快速过滤
   - 或点击"过滤器"按钮展开面板进行高级过滤
   - 可以同时使用搜索和多个过滤条件

---

## 🐛 故障排查

如果功能不工作：

1. **检查浏览器控制台**:
   - 打开开发者工具（F12）
   - 查看 Console 标签页是否有错误
   - 查看 Network 标签页检查 API 请求是否成功

2. **检查后端日志**:
   ```bash
   cd env
   docker compose logs backend --tail 50
   ```
   应该看到 API 请求记录

3. **检查前端日志**:
   ```bash
   cd env
   docker compose logs frontend --tail 50
   ```
   查看是否有编译错误

4. **验证 API 端点**:
   ```bash
   curl http://localhost:8000/api/v1/tickets
   curl http://localhost:8000/api/v1/tags
   curl "http://localhost:8000/api/v1/tickets?search=测试"
   ```

---

## 批量操作功能

### ✅ 已实现的批量操作

#### 1. 批量选择
- **位置**: 每个 Ticket 列表项左侧的复选框
- **功能**:
  - 点击复选框选择/取消选择单个 Ticket
  - 工具栏显示"批量操作"按钮
  - 选择后显示"已选择 X 项"

#### 2. 全选功能
- **位置**: 工具栏的"批量操作"按钮
- **功能**:
  - 点击可全选/取消全选所有 Ticket
  - 自动更新选择状态

#### 3. 批量删除
- **位置**: 选择 Ticket 后显示的"批量删除"按钮
- **功能**:
  - 批量删除选中的 Ticket（软删除）
  - 确认对话框
  - 删除后自动刷新列表

#### 4. 取消选择
- **位置**: 选择 Ticket 后显示的"取消选择"按钮
- **功能**:
  - 一键清除所有选择

### API 调用

批量删除通过循环调用单个删除 API 实现：
```typescript
await Promise.all(
  Array.from(selectedTicketIds).map((id) =>
    ticketService.deleteTicket(id, false)
  )
)
```

---

## 排序功能

### ✅ 已实现的排序功能

#### 1. 排序字段选择
- **位置**: 工具栏右侧的排序选择器
- **选项**:
  - 创建时间（默认）
  - 更新时间
  - 标题

#### 2. 排序方向切换
- **位置**: 排序选择器旁边的箭头按钮
- **功能**:
  - 点击切换升序/降序
  - 向上箭头 = 升序（asc）
  - 向下箭头 = 降序（desc，默认）

#### 3. API 调用
- **参数**: `sort_by` 和 `sort_order`
- **实时更新**: 改变排序条件时自动刷新列表

---

**状态**: ✅ 所有功能已实现并关联后端 API

**UI 设计**: ✅ 参考现代 Ticket 管理系统设计，已优化布局和交互
