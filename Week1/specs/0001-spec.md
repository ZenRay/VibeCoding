# Project Alpha - Ticket 管理系统需求与设计文档

## 1. 项目概述

### 1.1 项目简介
Project Alpha 是一个基于标签的 Ticket 管理工具，旨在帮助用户高效地创建、管理和跟踪任务。系统采用前后端分离架构，无需复杂的用户认证系统，专注于提供简洁高效的任务管理体验。

### 1.2 技术栈

#### 1.2.1 后端技术栈
- **语言**：Python 3.12
- **Web 框架**：FastAPI 0.109+
- **数据库**：PostgreSQL 16
- **ORM**：SQLAlchemy 2.0+
- **数据库迁移**：Alembic 1.13+
- **数据验证**：Pydantic 2.5+
- **包管理器**：UV（现代化的 Python 包管理工具）
- **ASGI 服务器**：Uvicorn

#### 1.2.2 前端技术栈
- **语言**：TypeScript 5.3+
- **构建工具**：Vite 5.0+
- **UI 框架**：React 18.2+
- **样式方案**：
  - Tailwind CSS 3.4+
  - PostCSS + Autoprefixer
- **组件库**：Shadcn UI（基于 Radix UI）
- **状态管理**：Zustand 4.5+（或 React Context API）
- **HTTP 客户端**：Axios 1.6+
- **包管理器**：npm / pnpm

#### 1.2.3 开发环境
- **容器化**：Docker + Docker Compose
- **数据库管理**：PgAdmin 4（可选）
- **API 文档与测试**：
  - Swagger UI（FastAPI 内置，自动生成）
  - ReDoc（FastAPI 内置，更美观的文档视图）
  - Postman / Insomnia（API 手动测试，可选）
  - httpie / curl（命令行 API 测试）
- **代码规范**：
  - 后端：Black + isort + Ruff
  - 前端：ESLint + Prettier
- **版本控制**：Git
- **提交规范**：Conventional Commits

### 1.3 核心特性
- 轻量级设计，无需用户登录系统
- 基于标签的灵活分类管理
- 直观的任务状态管理
- 快速的全文搜索功能

---

## 2. 功能需求

### 2.1 Ticket 管理

#### 2.1.1 创建 Ticket
- **描述**：用户可以创建新的 Ticket
- **输入字段**：
  - 标题（Title）：必填，最大长度 200 字符
  - 描述（Description）：可选，支持多行文本，最大长度 5000 字符
  - 标签（Tags）：可选，支持多个标签
- **输出**：
  - 自动生成唯一 ID
  - 自动记录创建时间
  - 默认状态为"未完成"（pending）

#### 2.1.2 编辑 Ticket
- **描述**：用户可以修改已存在的 Ticket 信息
- **可编辑字段**：
  - 标题
  - 描述
- **约束**：
  - 不能编辑 ID、创建时间
  - 自动更新修改时间

#### 2.1.3 删除 Ticket
- **描述**：用户可以删除 Ticket（软删除）
- **行为**：
  - 软删除，标记为已删除但保留数据
  - 已删除的 Ticket 默认不在列表中显示
  - 可以恢复已删除的 Ticket
  - 已删除的 Ticket 保留与标签的关联关系
- **确认机制**：删除前需要用户二次确认
- **扩展功能**：
  - 查看回收站（显示已删除的 Ticket）
  - 恢复已删除的 Ticket
  - 永久删除（可选，需要管理员权限或特定操作）

#### 2.1.4 完成/取消完成 Ticket
- **描述**：用户可以标记 Ticket 的完成状态
- **状态切换**：
  - 未完成（pending）↔ 已完成（completed）
- **记录**：
  - 记录状态变更时间
  - 已完成的 Ticket 在列表中有明显的视觉区分

### 2.2 标签管理

#### 2.2.1 添加标签到 Ticket
- **描述**：用户可以为 Ticket 添加一个或多个标签
- **标签属性**：
  - 名称：必填，最大长度 50 字符
  - 颜色：系统预设或用户自定义（HEX 格式）
- **约束**：
  - 一个 Ticket 可以有多个标签
  - 标签名称的英文字符统一转换为大写存储和显示（如 "backend" → "BACKEND"）
  - 中文、数字和特殊字符保持原样
  - 自动去除首尾空格
  - 如果标签不存在，自动创建新标签
- **标准化规则**：
  - 输入 "frontend" → 存储和显示为 "FRONTEND"
  - 输入 "Bug修复" → 存储和显示为 "BUG修复"
  - 输入 "v2.0" → 存储和显示为 "V2.0"

#### 2.2.2 删除 Ticket 的标签
- **描述**：用户可以移除 Ticket 上的指定标签
- **行为**：
  - 只删除关联关系，不删除标签本身
  - 如果某个标签没有关联任何 Ticket，可选择是否删除该标签

#### 2.2.3 标签管理
- **全局标签列表**：查看所有已创建的标签
- **标签编辑**：修改标签名称和颜色
- **标签删除**：删除标签时同时删除所有关联关系

### 2.3 查询与过滤

#### 2.3.1 按标签查看 Ticket 列表
- **描述**：用户可以通过选择一个或多个标签来过滤 Ticket
- **过滤逻辑**：
  - 单标签过滤：显示包含该标签的所有 Ticket
  - 多标签过滤（AND）：显示同时包含所有选中标签的 Ticket
  - 多标签过滤（OR）：显示包含任一选中标签的 Ticket
- **排序**：
  - 默认按创建时间倒序
  - 支持按更新时间、标题字母顺序排序

#### 2.3.2 按标题搜索 Ticket
- **描述**：用户可以通过关键词搜索 Ticket
- **搜索范围**：
  - 主要搜索标题字段
  - 可选扩展到描述字段
- **搜索特性**：
  - 实时搜索（输入时动态更新结果）
  - 不区分大小写
  - 支持模糊匹配
  - 高亮显示匹配关键词

#### 2.3.3 综合查询
- **描述**：支持标签过滤和文本搜索的组合使用
- **状态过滤**：
  - 全部 Ticket
  - 仅未完成
  - 仅已完成

#### 2.3.4 回收站功能
- **描述**：查看和管理已删除的 Ticket
- **功能**：
  - 查看所有已删除的 Ticket
  - 恢复已删除的 Ticket
  - 永久删除 Ticket（可选）
  - 批量清空回收站（可选）
- **视觉设计**：
  - 已删除的 Ticket 有明显的视觉标识
  - 显示删除时间

---

## 3. 数据库设计

### 3.1 数据库选型
- **数据库**：PostgreSQL 16
- **理由**：
  - 成熟稳定的关系型数据库
  - 优秀的全文搜索支持
  - 良好的 JSON 类型支持
  - 与 FastAPI 生态集成良好

### 3.2 数据表设计

#### 3.2.1 tickets 表
```sql
CREATE TABLE tickets (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    completed_at TIMESTAMP WITH TIME ZONE,
    deleted_at TIMESTAMP WITH TIME ZONE,
    CONSTRAINT status_check CHECK (status IN ('pending', 'completed'))
);

-- 索引
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_created_at ON tickets(created_at DESC);
CREATE INDEX idx_tickets_deleted_at ON tickets(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_tickets_active ON tickets(deleted_at) WHERE deleted_at IS NULL;
CREATE INDEX idx_tickets_title ON tickets USING gin(to_tsvector('english', title));
```

**字段说明**：
- `id`：主键，自增整数
- `title`：标题，必填
- `description`：描述，可选
- `status`：状态，枚举值（pending, completed）
- `created_at`：创建时间，自动生成
- `updated_at`：更新时间，自动更新
- `completed_at`：完成时间，状态变为 completed 时记录
- `deleted_at`：软删除时间，NULL 表示未删除

#### 3.2.2 tags 表
```sql
CREATE TABLE tags (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    color VARCHAR(7) NOT NULL DEFAULT '#6B7280',
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT color_format CHECK (color ~ '^#[0-9A-Fa-f]{6}$')
);

-- 索引
-- name 字段已设置 UNIQUE，会自动创建唯一索引
```

**字段说明**：
- `id`：主键，自增整数
- `name`：标签名称，唯一，英文字符会自动转换为大写（通过触发器）
- `color`：标签颜色，HEX 格式
- `created_at`：创建时间

**标准化规则**：
- 英文字母自动转换为大写
- 中文、数字、特殊字符保持原样
- 自动去除首尾空格

#### 3.2.3 ticket_tags 表（关联表）
```sql
CREATE TABLE ticket_tags (
    ticket_id INTEGER NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
    tag_id INTEGER NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    PRIMARY KEY (ticket_id, tag_id)
);

-- 索引
CREATE INDEX idx_ticket_tags_ticket_id ON ticket_tags(ticket_id);
CREATE INDEX idx_ticket_tags_tag_id ON ticket_tags(tag_id);
```

**字段说明**：
- `ticket_id`：Ticket ID，外键
- `tag_id`：Tag ID，外键
- `created_at`：关联创建时间
- 联合主键确保同一 Ticket 不会重复添加相同标签

### 3.3 数据库触发器

#### 3.3.1 自动更新 updated_at
```sql
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_tickets_updated_at 
    BEFORE UPDATE ON tickets
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();
```

#### 3.3.2 自动设置 completed_at
```sql
CREATE OR REPLACE FUNCTION set_completed_at()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.status = 'completed' AND OLD.status != 'completed' THEN
        NEW.completed_at = NOW();
    ELSIF NEW.status = 'pending' THEN
        NEW.completed_at = NULL;
    END IF;
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER set_ticket_completed_at 
    BEFORE UPDATE ON tickets
    FOR EACH ROW
    EXECUTE FUNCTION set_completed_at();
```

#### 3.3.3 标签名称标准化（英文转大写）
```sql
CREATE OR REPLACE FUNCTION normalize_tag_name()
RETURNS TRIGGER AS $$
BEGIN
    -- 去除首尾空格，并将英文字符转换为大写
    -- UPPER() 函数只会转换英文字符，中文、数字和特殊字符保持不变
    NEW.name = TRIM(UPPER(NEW.name));
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER normalize_tag_name_on_insert
    BEFORE INSERT ON tags
    FOR EACH ROW
    EXECUTE FUNCTION normalize_tag_name();

CREATE TRIGGER normalize_tag_name_on_update
    BEFORE UPDATE ON tags
    FOR EACH ROW
    EXECUTE FUNCTION normalize_tag_name();
```

**说明**：
- 自动去除标签名称首尾空格
- 将英文字母转换为大写（A-Z）
- 中文、数字和特殊字符保持原样
- 同时作用于 INSERT 和 UPDATE 操作

---

## 4. API 设计

### 4.1 API 基础信息
- **基础路径**：`/api/v1`
- **数据格式**：JSON
- **响应规范**：RESTful 风格
- **API 文档标准**：OpenAPI 3.0（Swagger）

### 4.2 API 文档与测试工具

#### 4.2.1 FastAPI 自动生成的 API 文档

FastAPI 内置了强大的 API 文档功能，基于 **OpenAPI 3.0** 标准，无需额外配置即可使用。

**文档访问地址**：
- **Swagger UI**：http://localhost:8000/docs
  - 交互式 API 文档
  - 可直接在浏览器中测试 API
  - 支持参数输入和响应查看
  - 显示请求/响应模型
  
- **ReDoc**：http://localhost:8000/redoc
  - 更美观的文档展示
  - 适合作为对外文档
  - 响应式设计，移动端友好
  - 更好的可读性

- **OpenAPI JSON**：http://localhost:8000/openapi.json
  - OpenAPI 规范的 JSON 格式
  - 可导入到其他工具（Postman、Insomnia）

**主要特性**：
- ✅ **自动生成**：基于 Pydantic 模型和类型注解自动生成
- ✅ **实时更新**：代码修改后文档自动同步
- ✅ **交互测试**：Swagger UI 支持直接测试 API
- ✅ **模型展示**：自动展示请求和响应数据结构
- ✅ **参数验证**：显示参数类型、默认值、是否必填等

#### 4.2.2 API 文档增强

**在代码中添加文档说明**：

```python
from fastapi import FastAPI, Query, Path, Body
from typing import Optional

app = FastAPI(
    title="Project Alpha API",
    description="基于标签的 Ticket 管理系统 API",
    version="1.0.0",
    docs_url="/docs",
    redoc_url="/redoc",
    openapi_url="/openapi.json",
)

@app.get(
    "/api/v1/tickets/{ticket_id}",
    summary="获取单个 Ticket",
    description="根据 Ticket ID 获取详细信息，包括关联的标签",
    response_description="返回 Ticket 详细信息",
    tags=["Tickets"],
)
async def get_ticket(
    ticket_id: int = Path(..., description="Ticket ID", example=1),
    include_deleted: bool = Query(False, description="是否包含已删除的 Ticket"),
):
    """
    获取单个 Ticket 的详细信息
    
    - **ticket_id**: Ticket 的唯一标识符
    - **include_deleted**: 是否包含已删除的 Ticket（默认：false）
    
    返回 Ticket 的完整信息，包括：
    - 基本信息（标题、描述、状态）
    - 关联的标签列表
    - 时间戳（创建、更新、完成、删除）
    """
    # 实现逻辑
    pass
```

**Pydantic 模型文档**：

```python
from pydantic import BaseModel, Field
from typing import Optional, List

class TicketCreate(BaseModel):
    """创建 Ticket 的请求模型"""
    
    title: str = Field(
        ..., 
        max_length=200,
        description="Ticket 标题",
        example="实现用户认证功能"
    )
    description: Optional[str] = Field(
        None,
        max_length=5000,
        description="Ticket 详细描述",
        example="添加 JWT 认证机制，包括登录、注册和令牌刷新"
    )
    tag_ids: Optional[List[int]] = Field(
        None,
        description="关联的标签 ID 列表",
        example=[1, 2, 3]
    )
    
    class Config:
        schema_extra = {
            "example": {
                "title": "实现用户认证功能",
                "description": "添加 JWT 认证机制",
                "tag_ids": [1, 2]
            }
        }
```

#### 4.2.3 API 测试工具

**1. Swagger UI（内置，推荐用于开发）**
- 优点：集成在应用中，无需额外安装
- 用途：快速测试和调试 API
- 使用方法：
  1. 访问 http://localhost:8000/docs
  2. 选择要测试的 API 端点
  3. 点击"Try it out"
  4. 填写参数并执行

**2. Postman（推荐用于团队协作）**
- 优点：功能强大，支持环境变量、测试脚本、团队共享
- 用途：系统化的 API 测试和文档管理
- 使用方法：
  1. 导入 OpenAPI JSON：http://localhost:8000/openapi.json
  2. 自动生成所有 API 请求
  3. 配置环境变量（BASE_URL 等）
  4. 保存常用请求到 Collection

**3. Insomnia（推荐用于个人使用）**
- 优点：界面简洁，支持 GraphQL，开源
- 用途：轻量级 API 测试
- 使用方法：类似 Postman

**4. httpie（命令行工具）**
```bash
# 安装
pip install httpie

# 获取 Ticket 列表
http GET localhost:8000/api/v1/tickets

# 创建 Ticket
http POST localhost:8000/api/v1/tickets \
  title="新任务" \
  description="任务描述" \
  tag_ids:='[1,2]'

# 更新 Ticket
http PUT localhost:8000/api/v1/tickets/1 \
  title="更新后的标题"

# 删除 Ticket
http DELETE localhost:8000/api/v1/tickets/1
```

**5. curl（系统自带）**
```bash
# 获取 Ticket 列表
curl -X GET "http://localhost:8000/api/v1/tickets?status=pending&page=1&page_size=20"

# 创建 Ticket
curl -X POST "http://localhost:8000/api/v1/tickets" \
  -H "Content-Type: application/json" \
  -d '{"title":"新任务","description":"任务描述","tag_ids":[1,2]}'

# 更新 Ticket
curl -X PUT "http://localhost:8000/api/v1/tickets/1" \
  -H "Content-Type: application/json" \
  -d '{"title":"更新后的标题"}'

# 删除 Ticket
curl -X DELETE "http://localhost:8000/api/v1/tickets/1"
```

#### 4.2.4 API 测试最佳实践

**开发阶段**：
1. 使用 **Swagger UI** 快速测试单个 API
2. 使用 **httpie** 或 **curl** 编写简单的测试脚本
3. 重要的 API 流程使用 **Postman** 保存为 Collection

**测试阶段**：
1. 使用 **pytest** 编写自动化测试
2. 使用 **Postman** 的 Newman 运行 Collection 测试
3. 编写 E2E 测试覆盖完整用户流程

**生产环境**：
1. 配置 **API 监控**（如 Sentry、DataDog）
2. 定期运行 **健康检查**
3. 记录和分析 **API 调用日志**

#### 4.2.5 API 文档部署

**开发环境**：
- Swagger UI 和 ReDoc 默认启用
- 可通过 `/docs` 和 `/redoc` 访问

**生产环境**：
```python
# 可选择性关闭或限制访问
app = FastAPI(
    # 生产环境可选择关闭文档
    docs_url="/docs" if settings.ENVIRONMENT == "development" else None,
    redoc_url="/redoc" if settings.ENVIRONMENT == "development" else None,
    # 或者使用内部地址
    # docs_url="/internal/docs",
    # redoc_url="/internal/redoc",
)
```

**导出静态文档**（可选）：
```bash
# 导出 OpenAPI JSON
curl http://localhost:8000/openapi.json > openapi.json

# 使用 redoc-cli 生成静态 HTML
npm install -g redoc-cli
redoc-cli bundle openapi.json -o api-docs.html
```

### 4.3 Ticket 相关 API

#### 4.2.1 获取 Ticket 列表
```
GET /api/v1/tickets
```

**查询参数**：
- `status` (可选): pending | completed | all (默认: all)
- `include_deleted` (可选): true | false (默认: false) - 是否包含已删除的 Ticket
- `only_deleted` (可选): true | false (默认: false) - 仅显示已删除的 Ticket（回收站）
- `tag_ids` (可选): 标签 ID 列表，逗号分隔
- `tag_filter` (可选): and | or (默认: and)
- `search` (可选): 搜索关键词
- `sort_by` (可选): created_at | updated_at | title (默认: created_at)
- `sort_order` (可选): asc | desc (默认: desc)
- `page` (可选): 页码，从 1 开始 (默认: 1)
- `page_size` (可选): 每页数量 (默认: 20, 最大: 100)

**响应示例**：
```json
{
  "data": [
    {
      "id": 1,
      "title": "实现用户认证功能",
      "description": "添加 JWT 认证机制",
      "status": "pending",
      "tags": [
        {
          "id": 1,
          "name": "BACKEND后端",
          "color": "#3B82F6"
        },
        {
          "id": 2,
          "name": "HIGH高优先级",
          "color": "#EF4444"
        }
      ],
      "created_at": "2026-01-08T10:00:00Z",
      "updated_at": "2026-01-08T10:00:00Z",
      "completed_at": null
    }
  ],
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 42,
    "total_pages": 3
  }
}
```

#### 4.2.2 获取单个 Ticket
```
GET /api/v1/tickets/{ticket_id}
```

**响应示例**：
```json
{
  "id": 1,
  "title": "实现用户认证功能",
  "description": "添加 JWT 认证机制",
  "status": "pending",
  "tags": [
    {
      "id": 1,
      "name": "BACKEND后端",
      "color": "#3B82F6"
    }
  ],
  "created_at": "2026-01-08T10:00:00Z",
  "updated_at": "2026-01-08T10:00:00Z",
  "completed_at": null
}
```

#### 4.2.3 创建 Ticket
```
POST /api/v1/tickets
```

**请求体**：
```json
{
  "title": "实现用户认证功能",
  "description": "添加 JWT 认证机制",
  "tag_ids": [1, 2]
}
```

**响应**：201 Created + Ticket 对象

#### 4.2.4 更新 Ticket
```
PUT /api/v1/tickets/{ticket_id}
```

**请求体**：
```json
{
  "title": "实现用户认证功能（更新）",
  "description": "添加 JWT 认证机制和刷新令牌"
}
```

**响应**：200 OK + 更新后的 Ticket 对象

#### 4.2.5 删除 Ticket（软删除）
```
DELETE /api/v1/tickets/{ticket_id}
```

**查询参数**：
- `permanent` (可选): true | false (默认: false) - 是否永久删除

**响应**：
- 软删除：200 OK + 更新后的 Ticket 对象（包含 deleted_at）
- 永久删除：204 No Content

#### 4.2.6 恢复已删除的 Ticket
```
POST /api/v1/tickets/{ticket_id}/restore
```

**响应**：200 OK + 恢复后的 Ticket 对象（deleted_at 为 null）

#### 4.2.7 切换 Ticket 完成状态
```
PATCH /api/v1/tickets/{ticket_id}/toggle-status
```

**响应**：200 OK + 更新后的 Ticket 对象

### 4.4 标签相关 API

#### 4.4.1 获取标签列表
```
GET /api/v1/tags
```

**查询参数**：
- `sort_by` (可选): name | created_at | usage_count (默认: name)
- `sort_order` (可选): asc | desc (默认: asc)

**响应示例**：
```json
{
  "data": [
    {
      "id": 1,
      "name": "BACKEND后端",
      "color": "#3B82F6",
      "ticket_count": 15,
      "created_at": "2026-01-08T10:00:00Z"
    }
  ]
}
```

#### 4.4.2 创建标签
```
POST /api/v1/tags
```

**请求体**：
```json
{
  "name": "frontend前端",
  "color": "#10B981"
}
```

**说明**：
- 输入的标签名称会自动标准化（英文字符转大写，去除首尾空格）
- 如 "frontend前端" 会被存储为 "FRONTEND前端"

**响应**：201 Created + Tag 对象

#### 4.4.3 更新标签
```
PUT /api/v1/tags/{tag_id}
```

**请求体**：
```json
{
  "name": "frontend dev前端开发",
  "color": "#10B981"
}
```

**说明**：
- 更新时同样会自动标准化标签名称
- 如 "frontend dev前端开发" 会被存储为 "FRONTEND DEV前端开发"

**响应**：200 OK + 更新后的 Tag 对象

#### 4.4.4 删除标签
```
DELETE /api/v1/tags/{tag_id}
```

**响应**：204 No Content

#### 4.4.5 为 Ticket 添加标签
```
POST /api/v1/tickets/{ticket_id}/tags
```

**请求体**：
```json
{
  "tag_id": 1
}
```

**响应**：200 OK + 更新后的 Ticket 对象

#### 4.4.6 从 Ticket 移除标签
```
DELETE /api/v1/tickets/{ticket_id}/tags/{tag_id}
```

**响应**：200 OK + 更新后的 Ticket 对象

### 4.5 错误响应

**统一错误格式**：
```json
{
  "error": {
    "code": "TICKET_NOT_FOUND",
    "message": "找不到指定的 Ticket",
    "details": {}
  }
}
```

**常见错误码**：
- `400 Bad Request`: 请求参数错误
- `404 Not Found`: 资源不存在
- `409 Conflict`: 资源冲突（如标签名称重复）
- `422 Unprocessable Entity`: 验证失败
- `500 Internal Server Error`: 服务器内部错误

---

## 5. 前端设计

### 5.1 页面结构

#### 5.1.1 主页面（Ticket 列表）
**组件结构**：
```
AppLayout
├── Header
│   ├── Logo
│   └── SearchBar
├── Sidebar
│   ├── FilterPanel
│   │   ├── StatusFilter (全部/未完成/已完成)
│   │   └── TagFilter (标签列表 + 多选)
│   ├── TagManagement (标签管理入口)
│   └── TrashBin (回收站入口)
└── MainContent
    ├── Toolbar
    │   ├── CreateTicketButton
    │   └── SortOptions
    └── TicketList
        └── TicketCard (多个)
```

#### 5.1.2 Ticket 详情弹窗
- 模态对话框形式
- 显示完整的 Ticket 信息
- 支持内联编辑
- 标签管理（添加/删除）
- 状态切换按钮
- 删除按钮

#### 5.1.3 标签管理页面
- 标签列表（带使用次数统计）
- 创建新标签
- 编辑标签（名称、颜色）
- 删除标签（带确认）

#### 5.1.4 回收站页面
- 显示所有已删除的 Ticket
- 每个 Ticket 显示删除时间
- 恢复按钮（单个或批量）
- 永久删除按钮（带二次确认）
- 清空回收站按钮（可选）
- **视觉样式**（已删除的 Ticket）：
  - 标题和描述添加删除线（`text-decoration: line-through`）
  - 整体半透明效果（`opacity: 0.6`）
  - 灰色调（降低饱和度）
  - 卡片背景色使用浅灰色（`bg-gray-50`）
  - 悬停时略微提高透明度以增强交互感

### 5.2 UI/UX 设计原则

#### 5.2.1 视觉设计
- **设计风格**：现代简约，扁平化设计
- **色彩方案**：
  - 主色：蓝色系（#3B82F6）
  - 辅助色：灰色系（#6B7280）
  - 成功：绿色（#10B981）
  - 警告：黄色（#F59E0B）
  - 错误：红色（#EF4444）
- **字体**：
  - 标题：Inter / SF Pro / 思源黑体
  - 正文：Inter / SF Pro / 思源黑体
  - 代码：Fira Code / Consolas
- **软删除视觉规范**：
  - **删除线**：标题和描述文本添加删除线
  - **透明度**：整体 `opacity: 0.6`
  - **背景色**：使用 `bg-gray-50` 或 `bg-gray-100`
  - **颜色去饱和**：标签和状态指示器使用灰色版本
  - **交互反馈**：
    - 悬停时透明度提升至 `opacity: 0.8`
    - 显示"已删除"徽章或图标（如垃圾桶图标）
  - **删除时间**：显示"已删除于 X 天前"等时间提示

#### 5.2.2 交互设计
- **即时反馈**：
  - 按钮点击有视觉反馈
  - 加载状态使用骨架屏或加载动画
  - 操作成功/失败使用 Toast 提示
- **键盘快捷键**：
  - `N`：创建新 Ticket
  - `Ctrl/Cmd + K`：聚焦搜索框
  - `Esc`：关闭弹窗
- **拖放排序**：未来版本可支持 Ticket 拖放重排

#### 5.2.3 响应式设计
- **桌面端**（>=1024px）：侧边栏 + 主内容区
- **平板端**（768px-1023px）：可折叠侧边栏
- **移动端**（<768px）：
  - 侧边栏变为抽屉式
  - 搜索栏自适应
  - 卡片布局单列显示

#### 5.2.4 软删除视觉最佳实践

**核心原则**：已删除的内容应该明显区分但仍可读，便于用户判断是否需要恢复。

**视觉层次**：
1. **主要标识**：删除线（最重要的视觉提示）
2. **次要标识**：透明度降低、灰色调
3. **辅助标识**：删除徽章、删除时间

**具体实现规范**：

| 元素 | 正常状态 | 已删除状态 | CSS/Tailwind 类 |
|------|---------|-----------|----------------|
| 标题文本 | 黑色，无装饰 | 灰色 + 删除线 | `text-gray-600 line-through decoration-2` |
| 描述文本 | 深灰色 | 浅灰色 + 删除线 | `text-gray-500 line-through` |
| 卡片背景 | 白色 | 浅灰色 | `bg-gray-50` 或 `bg-gray-100` |
| 整体透明度 | 100% | 60% | `opacity-60` |
| 悬停透明度 | - | 80% | `hover:opacity-80` |
| 标签徽章 | 彩色 | 灰色 | `bg-gray-200 text-gray-600 border-gray-300` |
| 状态徽章 | 彩色 | 灰色 | 同上 |

**交互反馈**：
- ✅ 悬停时提升透明度，表明可交互
- ✅ 显示删除时间和恢复按钮
- ✅ 添加"已删除"徽章或图标
- ❌ 不要使用完全透明或模糊效果（影响可读性）
- ❌ 不要使用红色背景（过于刺眼）

**无障碍支持**：
```html
<!-- 添加语义化标签 -->
<div role="article" aria-label="已删除的任务" aria-describedby="delete-info">
  <h3 className="line-through">任务标题</h3>
  <span id="delete-info" className="sr-only">
    此任务已于 2 天前删除，可以恢复或永久删除
  </span>
</div>
```

**动画效果**（可选）：
- 删除操作时：淡出 + 轻微上移
- 恢复操作时：淡入 + 轻微下移
- 悬停时：平滑的透明度过渡

```css
/* 删除动画 */
@keyframes delete-fade {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0.6;
    transform: translateY(-4px);
  }
}

/* 恢复动画 */
@keyframes restore-fade {
  from {
    opacity: 0.6;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

### 5.3 组件清单（Shadcn UI）

使用的 Shadcn UI 组件：
- `Button`：各种操作按钮
- `Input`：文本输入框
- `Textarea`：多行文本输入
- `Dialog`：对话框（Ticket 详情、确认删除等）
- `DropdownMenu`：下拉菜单（排序选项等）
- `Checkbox`：多选框（标签筛选）
- `Badge`：标签徽章
- `Card`：Ticket 卡片
- `Separator`：分隔线
- `Toast`：消息提示
- `Select`：下拉选择（状态筛选等）
- `Popover`：弹出层（颜色选择器等）

### 5.4 状态管理

#### 5.4.1 全局状态（推荐使用 Zustand 或 Context API）
- Ticket 列表
- 标签列表
- 当前筛选条件
- 当前搜索关键词

#### 5.4.2 本地状态
- 表单输入状态
- UI 状态（加载中、错误等）
- 弹窗开关状态

### 5.5 前端路由

使用 React Router（如果需要）：
```
/                    -> 主页（Ticket 列表）
/tickets/:id         -> Ticket 详情（或使用弹窗）
/tags                -> 标签管理页面（可选，或使用弹窗）
/trash               -> 回收站页面
```

---

## 6. 技术实现细节

### 6.1 后端实现（FastAPI）

#### 6.1.1 项目结构
```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py                 # 应用入口
│   ├── config.py               # 配置管理
│   ├── database.py             # 数据库连接
│   ├── models/                 # SQLAlchemy 模型
│   │   ├── __init__.py
│   │   ├── ticket.py
│   │   ├── tag.py
│   │   └── ticket_tag.py
│   ├── schemas/                # Pydantic 模式
│   │   ├── __init__.py
│   │   ├── ticket.py
│   │   └── tag.py
│   ├── api/                    # API 路由
│   │   ├── __init__.py
│   │   ├── tickets.py
│   │   └── tags.py
│   ├── services/               # 业务逻辑
│   │   ├── __init__.py
│   │   ├── ticket_service.py
│   │   └── tag_service.py
│   └── utils/                  # 工具函数
│       ├── __init__.py
│       └── exceptions.py
├── alembic/                    # 数据库迁移
│   ├── versions/
│   └── env.py
├── tests/                      # 测试
├── pyproject.toml              # 项目配置和依赖管理（UV）
├── uv.lock                     # 依赖锁文件（自动生成）
├── .python-version             # Python 版本固定为 3.12
└── .env.example
```

**说明**：
- 使用 **UV** 作为包管理器，替代传统的 pip + requirements.txt
- `pyproject.toml` 是 Python 项目的标准配置文件
- `uv.lock` 确保依赖版本的一致性
- `.python-version` 文件确保使用 Python 3.12

#### 6.1.2 核心依赖（pyproject.toml）

**Python 版本要求**：Python 3.12+

**依赖管理工具**：UV（https://github.com/astral-sh/uv）

**pyproject.toml 配置示例**：
```toml
[project]
name = "project-alpha-backend"
version = "0.1.0"
description = "Project Alpha Ticket Management System Backend"
requires-python = ">=3.12"
dependencies = [
    "fastapi>=0.109.0",
    "uvicorn[standard]>=0.27.0",
    "sqlalchemy>=2.0.25",
    "psycopg2-binary>=2.9.9",
    "alembic>=1.13.1",
    "pydantic>=2.5.3",
    "pydantic-settings>=2.1.0",
    "python-dotenv>=1.0.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "pytest-asyncio>=0.21.0",
    "black>=23.0.0",
    "isort>=5.12.0",
    "ruff>=0.1.0",
]

[tool.black]
line-length = 100
target-version = ["py312"]

[tool.isort]
profile = "black"
line_length = 100

[tool.ruff]
line-length = 100
target-version = "py312"
```

**UV 常用命令**：
```bash
# 安装 UV（如果还没有安装）
curl -LsSf https://astral.sh/uv/install.sh | sh

# 创建虚拟环境并安装依赖
uv venv
uv pip install -e .

# 添加新依赖
uv pip install <package-name>

# 同步依赖（根据 pyproject.toml）
uv pip sync

# 安装开发依赖
uv pip install -e ".[dev]"
```

#### 6.1.3 数据库连接配置
```python
# app/database.py
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from app.config import settings

SQLALCHEMY_DATABASE_URL = settings.database_url

engine = create_engine(SQLALCHEMY_DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

#### 6.1.4 环境变量配置
```python
# app/config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str = "postgresql://user:password@localhost:5432/ticketdb"
    api_v1_prefix: str = "/api/v1"
    
    class Config:
        env_file = ".env"

settings = Settings()
```

#### 6.1.5 标签名称标准化处理
**说明**：标签名称的标准化主要由数据库触发器自动完成，后端无需额外处理。

**数据库触发器负责**：
- 去除首尾空格：`TRIM()`
- 英文字符转大写：`UPPER()`
- 中文、数字和特殊字符保持原样

**后端职责**：
- 创建和更新标签时，直接传递用户输入到数据库
- 数据库触发器会自动标准化标签名称
- 返回标准化后的标签名称给前端

**示例**：
```python
# app/api/tags.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app import models, schemas
from app.database import get_db

router = APIRouter()

@router.post("/tags", response_model=schemas.Tag)
def create_tag(tag: schemas.TagCreate, db: Session = Depends(get_db)):
    # 直接创建标签，触发器会自动标准化名称
    db_tag = models.Tag(name=tag.name, color=tag.color)
    db.add(db_tag)
    db.commit()
    db.refresh(db_tag)
    # 返回的 db_tag.name 已经是标准化后的名称（英文大写）
    return db_tag
```

### 6.2 前端实现（TypeScript + Vite）

#### 6.2.1 项目结构
```
frontend/
├── src/
│   ├── main.tsx                # 应用入口
│   ├── App.tsx                 # 根组件
│   ├── components/             # 可复用组件
│   │   ├── ui/                 # Shadcn UI 组件
│   │   ├── TicketCard.tsx
│   │   ├── TicketDialog.tsx
│   │   ├── TagBadge.tsx
│   │   ├── SearchBar.tsx
│   │   ├── FilterPanel.tsx
│   │   └── DeletedTicketCard.tsx
│   ├── pages/                  # 页面组件
│   │   ├── HomePage.tsx
│   │   ├── TagManagementPage.tsx
│   │   └── TrashPage.tsx
│   ├── services/               # API 服务
│   │   ├── api.ts
│   │   ├── ticketService.ts
│   │   └── tagService.ts
│   ├── hooks/                  # 自定义 Hooks
│   │   ├── useTickets.ts
│   │   ├── useTags.ts
│   │   └── useDebounce.ts
│   ├── store/                  # 状态管理
│   │   └── useStore.ts
│   ├── types/                  # TypeScript 类型
│   │   ├── ticket.ts
│   │   └── tag.ts
│   ├── lib/                    # 工具库
│   │   └── utils.ts
│   └── styles/                 # 样式文件
│       └── globals.css
├── public/
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
├── tailwind.config.js
└── components.json             # Shadcn UI 配置
```

#### 6.2.2 核心依赖
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "axios": "^1.6.5",
    "zustand": "^4.5.0",
    "@radix-ui/react-*": "^1.0.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "lucide-react": "^0.309.0",
    "tailwind-merge": "^2.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.48",
    "@types/react-dom": "^18.2.18",
    "@vitejs/plugin-react": "^4.2.1",
    "typescript": "^5.3.3",
    "vite": "^5.0.11",
    "tailwindcss": "^3.4.1",
    "autoprefixer": "^10.4.17",
    "postcss": "^8.4.33"
  }
}
```

#### 6.2.3 API 服务封装
```typescript
// src/services/api.ts
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:8000/api/v1',
  headers: {
    'Content-Type': 'application/json',
  },
});

export default api;
```

#### 6.2.4 类型定义
```typescript
// src/types/ticket.ts
export interface Tag {
  id: number;
  name: string;
  color: string;
  created_at: string;
}

export interface Ticket {
  id: number;
  title: string;
  description: string | null;
  status: 'pending' | 'completed';
  tags: Tag[];
  created_at: string;
  updated_at: string;
  completed_at: string | null;
  deleted_at: string | null;  // 软删除时间，null 表示未删除
}

export interface CreateTicketRequest {
  title: string;
  description?: string;
  tag_ids?: number[];
}
```

#### 6.2.5 标签名称标准化处理
**说明**：标签名称的标准化由数据库触发器自动完成，前端主要负责用户体验。

**前端职责**：
1. **输入提示**：在创建/编辑标签时提示用户"英文字符会自动转换为大写"
2. **即时预览**：在输入框下方显示标准化后的预览（可选）
3. **展示标准化后的名称**：从后端接收的标签名称已经是标准化后的

**实现建议**：
```typescript
// src/utils/tagUtils.ts
/**
 * 预览标签标准化后的名称（用于前端展示）
 * 注意：实际标准化由数据库触发器完成
 */
export function previewNormalizedTagName(name: string): string {
  return name.trim().toUpperCase();
}

// 使用示例
// src/components/TagForm.tsx
import { previewNormalizedTagName } from '@/utils/tagUtils';

function TagForm() {
  const [tagName, setTagName] = useState('');
  const normalizedPreview = previewNormalizedTagName(tagName);
  
  return (
    <div>
      <Input 
        value={tagName} 
        onChange={(e) => setTagName(e.target.value)}
        placeholder="输入标签名称"
      />
      {tagName && (
        <p className="text-sm text-gray-500 mt-1">
          将保存为: <strong>{normalizedPreview}</strong>
        </p>
      )}
    </div>
  );
}
```

**注意事项**：
- 前端的预览只是给用户参考，真正的标准化由数据库完成
- 创建标签后，应该使用后端返回的标准化名称更新前端状态
- 避免在前端对标签名称进行大写转换后再发送，让数据库统一处理

#### 6.2.6 已删除 Ticket 的视觉实现

**说明**：已删除的 Ticket 需要明显的视觉区分，主要通过删除线、透明度和颜色变化来实现。

**实现方案 1：专用组件 `DeletedTicketCard`**
```typescript
// src/components/DeletedTicketCard.tsx
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Trash2, RotateCcw } from 'lucide-react';
import { Ticket } from '@/types/ticket';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

interface DeletedTicketCardProps {
  ticket: Ticket;
  onRestore: (id: number) => void;
  onPermanentDelete: (id: number) => void;
}

export function DeletedTicketCard({ ticket, onRestore, onPermanentDelete }: DeletedTicketCardProps) {
  return (
    <Card className="bg-gray-50 opacity-60 hover:opacity-80 transition-opacity">
      <CardHeader>
        <div className="flex items-start justify-between">
          <div className="flex-1">
            {/* 标题添加删除线 */}
            <CardTitle className="line-through text-gray-600 decoration-2">
              {ticket.title}
            </CardTitle>
            {/* 删除时间提示 */}
            {ticket.deleted_at && (
              <p className="text-xs text-gray-500 mt-1">
                已删除于 {formatDistanceToNow(new Date(ticket.deleted_at), { 
                  addSuffix: true, 
                  locale: zhCN 
                })}
              </p>
            )}
          </div>
          {/* 已删除徽章 */}
          <Badge variant="secondary" className="ml-2">
            <Trash2 className="w-3 h-3 mr-1" />
            已删除
          </Badge>
        </div>
        {/* 描述添加删除线 */}
        {ticket.description && (
          <CardDescription className="line-through text-gray-500">
            {ticket.description}
          </CardDescription>
        )}
      </CardHeader>
      <CardContent>
        {/* 标签显示为灰色 */}
        <div className="flex flex-wrap gap-2 mb-4">
          {ticket.tags.map((tag) => (
            <Badge 
              key={tag.id} 
              variant="outline"
              className="bg-gray-200 text-gray-600 border-gray-300"
            >
              {tag.name}
            </Badge>
          ))}
        </div>
        {/* 操作按钮 */}
        <div className="flex gap-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => onRestore(ticket.id)}
            className="flex-1"
          >
            <RotateCcw className="w-4 h-4 mr-1" />
            恢复
          </Button>
          <Button
            variant="destructive"
            size="sm"
            onClick={() => onPermanentDelete(ticket.id)}
          >
            <Trash2 className="w-4 h-4 mr-1" />
            永久删除
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

**实现方案 2：通用组件 + 条件样式**
```typescript
// src/components/TicketCard.tsx
import { cn } from '@/lib/utils';
import { Card } from '@/components/ui/card';
import { Ticket } from '@/types/ticket';

interface TicketCardProps {
  ticket: Ticket;
  onAction?: (id: number) => void;
}

export function TicketCard({ ticket, onAction }: TicketCardProps) {
  const isDeleted = !!ticket.deleted_at;
  
  return (
    <Card 
      className={cn(
        "transition-all",
        isDeleted && [
          "bg-gray-50",         // 灰色背景
          "opacity-60",         // 半透明
          "hover:opacity-80",   // 悬停时提高透明度
        ]
      )}
    >
      <div className="p-4">
        {/* 标题 - 已删除时添加删除线 */}
        <h3 
          className={cn(
            "text-lg font-semibold",
            isDeleted && "line-through text-gray-600 decoration-2"
          )}
        >
          {ticket.title}
        </h3>
        
        {/* 描述 - 已删除时添加删除线 */}
        {ticket.description && (
          <p 
            className={cn(
              "text-sm mt-2",
              isDeleted 
                ? "line-through text-gray-500" 
                : "text-gray-700"
            )}
          >
            {ticket.description}
          </p>
        )}
        
        {/* 标签 - 已删除时使用灰色 */}
        <div className="flex flex-wrap gap-2 mt-3">
          {ticket.tags.map((tag) => (
            <Badge 
              key={tag.id}
              style={!isDeleted ? { backgroundColor: tag.color } : undefined}
              className={cn(
                isDeleted && "bg-gray-200 text-gray-600 border-gray-300"
              )}
            >
              {tag.name}
            </Badge>
          ))}
        </div>
        
        {/* 已删除标识 */}
        {isDeleted && ticket.deleted_at && (
          <div className="flex items-center gap-2 mt-3 text-xs text-gray-500">
            <Trash2 className="w-3 h-3" />
            <span>
              已删除于 {formatDistanceToNow(new Date(ticket.deleted_at), { 
                addSuffix: true,
                locale: zhCN 
              })}
            </span>
          </div>
        )}
      </div>
    </Card>
  );
}
```

**Tailwind CSS 类说明**：
- `line-through`：文本删除线
- `decoration-2`：删除线粗细
- `opacity-60`：60% 透明度
- `hover:opacity-80`：悬停时 80% 透明度
- `bg-gray-50` / `bg-gray-100`：浅灰色背景
- `text-gray-600` / `text-gray-500`：灰色文本

**工具函数**：
```typescript
// src/lib/utils.ts
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

// 合并 Tailwind 类名，避免冲突
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

**使用建议**：
1. **回收站页面**：使用专用的 `DeletedTicketCard` 组件
2. **主列表页面**（如果显示已删除项）：使用通用 `TicketCard` 组件的条件样式
3. **性能优化**：使用 CSS 变量定义删除样式，便于统一管理
4. **无障碍支持**：添加 `aria-label` 说明 Ticket 已删除

**CSS 变量方案**（可选）：
```css
/* src/styles/globals.css */
.ticket-deleted {
  --ticket-opacity: 0.6;
  --ticket-bg: theme('colors.gray.50');
  --ticket-text: theme('colors.gray.600');
}

.ticket-deleted:hover {
  --ticket-opacity: 0.8;
}

.ticket-deleted .ticket-title,
.ticket-deleted .ticket-description {
  text-decoration: line-through;
  text-decoration-thickness: 2px;
  color: var(--ticket-text);
}
```

---

## 7. 开发环境配置

### 7.1 Docker Compose 配置
详见 `../env/docker-compose.yml` 文件

**服务组成**：
- `postgres`：PostgreSQL 数据库
- `backend`：FastAPI 后端服务
- `frontend`：Vite 开发服务器

### 7.2 环境变量
- **后端**：`.env`
  - `DATABASE_URL`：数据库连接字符串
  - `CORS_ORIGINS`：允许的跨域来源
- **前端**：`.env.local`
  - `VITE_API_URL`：后端 API 地址

---

## 8. 开发流程

### 8.1 环境要求

#### 8.1.1 必需软件
- **Python**：3.12 或更高版本
- **Node.js**：20.x LTS 或更高版本
- **Docker**：20.10 或更高版本
- **Docker Compose**：2.0 或更高版本
- **UV**：最新版本（Python 包管理器）

#### 8.1.2 安装 UV
```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# 验证安装
uv --version
```

### 8.2 初始化项目

#### 8.2.1 使用 Docker（推荐，一键启动）
```bash
# 进入 Week1 项目目录
cd Week1

# 启动所有服务（数据库、后端、前端）
cd env && docker compose up -d

# 查看服务状态
docker-compose -f env/docker-compose.yml ps

# 查看日志
docker-compose -f env/docker-compose.yml logs -f
```

**访问地址**：
- 前端：http://localhost:5173
- 后端 API：http://localhost:8000
- API 文档：http://localhost:8000/docs

#### 8.2.2 本地开发（不使用 Docker）

**1. 后端设置**：
```bash
# 进入后端目录
cd backend

# 确保使用 Python 3.12
python --version  # 应显示 Python 3.12.x

# 如果需要，可以创建 .python-version 文件
echo "3.12" > .python-version

# 创建虚拟环境并安装依赖（使用 UV）
uv venv
source .venv/bin/activate  # Linux/macOS
# 或 .venv\Scripts\activate  # Windows

# 安装项目依赖
uv pip install -e .

# 安装开发依赖
uv pip install -e ".[dev]"

# 复制环境变量配置
cp .env.example .env
# 编辑 .env 文件，配置数据库连接等

# 运行数据库迁移
alembic upgrade head

# 启动开发服务器
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**2. 前端设置**：
```bash
# 进入前端目录
cd frontend

# 安装依赖（使用 npm 或 pnpm）
npm install
# 或 pnpm install

# 复制环境变量配置
cp .env.example .env.local
# 编辑 .env.local，配置 API 地址

# 启动开发服务器
npm run dev
```

**3. 数据库设置**（如果本地运行）：
```bash
# 使用 Docker 运行 PostgreSQL
docker run -d \
  --name project-alpha-db \
  -e POSTGRES_DB=ticketdb \
  -e POSTGRES_USER=ticket \
  -e POSTGRES_PASSWORD=ticket \
  -p 5432:5432 \
  postgres:16-alpine

# 或者使用本地安装的 PostgreSQL
# 创建数据库
createdb -U postgres ticketdb
```

### 8.3 开发规范

#### 8.3.1 代码风格
**后端（Python）**：
- **格式化工具**：Black（行长度：100）
- **导入排序**：isort
- **代码检查**：Ruff
- **类型检查**：mypy（可选）

```bash
# 格式化代码
black app/

# 排序导入
isort app/

# 代码检查
ruff check app/

# 运行所有检查
black app/ && isort app/ && ruff check app/
```

**前端（TypeScript）**：
- **格式化工具**：Prettier
- **代码检查**：ESLint
- **类型检查**：tsc

```bash
# 格式化代码
npm run format

# 代码检查
npm run lint

# 类型检查
npm run type-check
```

#### 8.3.2 提交规范
遵循 **Conventional Commits** 规范：

```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型（type）**：
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式（不影响代码运行）
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

**示例**：
```bash
git commit -m "feat(ticket): add soft delete functionality"
git commit -m "fix(tag): normalize tag name to uppercase"
git commit -m "docs(spec): update API documentation"
```

#### 8.3.3 分支管理
使用简化的 **Git Flow** 模型：

- `main`：生产环境分支，始终保持稳定
- `develop`：开发分支，日常开发基础
- `feature/*`：功能分支，从 develop 分出
- `bugfix/*`：bug 修复分支
- `hotfix/*`：紧急修复分支，从 main 分出

**工作流程**：
```bash
# 创建功能分支
git checkout -b feature/ticket-search develop

# 开发完成后合并回 develop
git checkout develop
git merge --no-ff feature/ticket-search

# 发布时合并到 main
git checkout main
git merge --no-ff develop
git tag -a v1.0.0 -m "Release version 1.0.0"
```

### 8.4 测试策略

#### 8.4.1 后端测试
**测试框架**：pytest + pytest-asyncio

```bash
# 运行所有测试
pytest

# 运行特定测试文件
pytest tests/test_tickets.py

# 运行并显示覆盖率
pytest --cov=app --cov-report=html

# 运行并输出详细信息
pytest -v -s
```

**测试结构**：
```
tests/
├── conftest.py              # 测试配置和 fixtures
├── test_api/
│   ├── test_tickets.py      # Ticket API 测试
│   └── test_tags.py         # Tag API 测试
├── test_services/
│   ├── test_ticket_service.py
│   └── test_tag_service.py
└── test_models/
    └── test_models.py
```

#### 8.4.2 前端测试
**测试框架**：Vitest + React Testing Library

```bash
# 运行所有测试
npm run test

# 监听模式
npm run test:watch

# 覆盖率报告
npm run test:coverage
```

**测试结构**：
```
src/
├── components/
│   ├── TicketCard.tsx
│   └── TicketCard.test.tsx
├── hooks/
│   ├── useTickets.ts
│   └── useTickets.test.ts
└── services/
    ├── ticketService.ts
    └── ticketService.test.ts
```

#### 8.4.3 E2E 测试（可选）
**测试框架**：Playwright

```bash
# 安装 Playwright
npm install -D @playwright/test

# 运行 E2E 测试
npm run test:e2e

# 打开 UI 模式
npm run test:e2e:ui
```

### 8.5 数据库迁移

#### 8.5.1 创建迁移
```bash
# 自动生成迁移文件
alembic revision --autogenerate -m "Add deleted_at column to tickets"

# 手动创建迁移文件
alembic revision -m "Add custom index"
```

#### 8.5.2 应用迁移
```bash
# 升级到最新版本
alembic upgrade head

# 升级到特定版本
alembic upgrade <revision_id>

# 降级一个版本
alembic downgrade -1

# 查看迁移历史
alembic history

# 查看当前版本
alembic current
```

### 8.6 依赖管理

#### 8.6.1 后端依赖（UV）
```bash
# 添加新依赖
uv pip install <package-name>

# 添加开发依赖
uv pip install --dev <package-name>

# 更新依赖
uv pip install --upgrade <package-name>

# 同步依赖（根据 pyproject.toml）
uv pip sync

# 导出依赖列表（兼容传统工具）
uv pip freeze > requirements.txt
```

#### 8.6.2 前端依赖（npm/pnpm）
```bash
# 添加依赖
npm install <package-name>
pnpm add <package-name>

# 添加开发依赖
npm install -D <package-name>
pnpm add -D <package-name>

# 更新依赖
npm update
pnpm update

# 检查过期依赖
npm outdated
pnpm outdated
```

---

## 9. 部署方案

### 9.1 生产环境架构
```
用户 -> Nginx (反向代理)
         ├-> 前端静态文件
         └-> FastAPI 后端 (Uvicorn + Gunicorn)
                └-> PostgreSQL 数据库
```

### 9.2 Docker 生产环境配置
- 使用多阶段构建优化镜像大小
- 前端构建静态文件由 Nginx 服务
- 后端使用 Gunicorn + Uvicorn 运行
- 数据库数据持久化

### 9.3 性能优化
- 前端：
  - 代码分割（React.lazy）
  - 资源压缩和缓存
  - CDN 加速
- 后端：
  - 数据库连接池
  - 查询优化和索引
  - API 响应缓存（Redis，可选）

---

## 10. 未来扩展规划

### 10.1 短期功能（v1.1）
- Ticket 优先级
- 截止日期
- 评论功能
- 附件上传

### 10.2 中期功能（v2.0）
- 用户系统和权限管理
- Ticket 分配给负责人
- 看板视图（Kanban）
- 活动日志

### 10.3 长期功能（v3.0）
- 多项目支持
- 团队协作
- 统计报表和数据可视化
- Webhook 和 API 集成
- 移动端 App

---

## 11. 风险与挑战

### 11.1 技术风险
- **数据库性能**：随着数据量增长，查询性能可能下降
  - **缓解措施**：合理索引、分页、查询优化
- **并发处理**：多用户同时编辑可能导致冲突
  - **缓解措施**：乐观锁、版本控制

### 11.2 用户体验风险
- **搜索性能**：全文搜索可能较慢
  - **缓解措施**：PostgreSQL 全文搜索索引、防抖动
- **无用户系统的局限**：无法区分不同用户的数据
  - **缓解措施**：V2 版本添加用户系统

---

## 12. 附录

### 12.1 参考资料
- FastAPI 官方文档：https://fastapi.tiangolo.com/
- Shadcn UI 文档：https://ui.shadcn.com/
- PostgreSQL 文档：https://www.postgresql.org/docs/

### 12.2 设计灵感
- Linear：简洁高效的问题跟踪工具
- Todoist：优秀的任务管理体验
- Notion：灵活的标签系统

### 12.3 颜色预设
建议提供以下预设颜色供用户选择：
- 蓝色 `#3B82F6`
- 绿色 `#10B981`
- 黄色 `#F59E0B`
- 红色 `#EF4444`
- 紫色 `#8B5CF6`
- 粉色 `#EC4899`
- 灰色 `#6B7280`
- 青色 `#06B6D4`

---

## 文档版本
- **版本号**：v1.2
- **创建日期**：2026-01-08
- **作者**：Project Alpha 团队
- **最后更新**：2026-01-08

### 更新日志

#### v1.2 (2026-01-08)
- ✅ 添加 **API 文档与测试工具**专门章节（4.2 节）
  - FastAPI 内置的 Swagger UI 和 ReDoc 说明
  - API 文档增强方法（代码注释和示例）
  - API 测试工具推荐（Postman、Insomnia、httpie、curl）
  - API 测试最佳实践
  - API 文档部署配置
- ✅ 更新技术栈说明（1.2.3 节）
  - 明确列出 API 文档工具
  - 添加 API 测试工具选项
- ✅ 调整章节编号（4.3-4.5）

#### v1.1 (2026-01-08)
- ✅ 明确使用 **Python 3.12** 作为后端开发语言版本
- ✅ 采用 **UV** 作为 Python 包管理器，替代传统的 pip
- ✅ 更新项目结构，使用 `pyproject.toml` 替代 `requirements.txt`
- ✅ 详细列出前后端完整技术栈（1.2 节）
- ✅ 更新开发流程文档（第 8 章）
  - 添加环境要求说明
  - 添加 UV 安装和使用指南
  - 完善本地开发设置步骤
  - 添加依赖管理详细说明
- ✅ 更新 Docker 配置文件
  - Dockerfile.backend 使用 Python 3.12 和 UV
  - 提供 pyproject.toml 示例文件
  - 提供 .python-version 示例文件
- ✅ 更新 env/README.md，添加 UV 使用指南

#### v1.0 (2026-01-08)
- 初始版本发布
- 完整的功能需求和设计文档
- 数据库设计（含软删除支持）
- API 设计规范
- 前端 UI/UX 设计
- Docker 开发环境配置
